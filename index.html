<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Cache-Control" content="no-cache">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">

        <!-- Favicon removed - logo.png file not available -->
        <link rel="stylesheet" href="coloris.min.css">
        
        <!-- FontAwesome for icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <title>Diffusion Lab</title>
        <meta name="description" content="Watch your creations come alive as AI transforms fluid simulations, camera stream, videos or audio into mesmerizing generative art in real-time.">

        <meta property="og:type" content="website">
        <meta property="og:title" content="Diffusion Lab">
        <meta property="og:description" content="Watch your creations come alive as AI transforms fluid simulations, camera stream, videos or audio into mesmerizing generative art in real-time.">
        <meta property="og:url" content="https://paveldogreat.github.io/WebGL-Fluid-Simulation/">
        <!-- Open Graph image removed - logo.png file not available -->

        <!-- Modern custom UI - no external dependencies -->
        <style>
            /* Modern CSS Reset and Base Styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            /* Prevent text selection on interactive elements */
            button, input, textarea, select, .slider-container, .color-input, .clr-field, .preset-button, .modern-button, .toggle-switch, .checkbox-input, .checkbox-label {
                user-select: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
            }

            /* Allow text selection in content areas */
            p, h1, h2, h3, h4, h5, h6, li, span, div, code, pre, .welcome-content, .advanced-setup-content, .step-content, .feature-description {
                user-select: text;
                -webkit-user-select: text;
                -moz-user-select: text;
                -ms-user-select: text;
            }

            :root {
                --primary-bg: #0a0a0a;
                --secondary-bg: rgba(20, 20, 30, 0.95);
                --control-bg: rgba(40, 40, 50, 0.9);
                --accent-color: #06a3d7;
                --accent-hover: #00b8e6;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --border-color: rgba(255, 255, 255, 0.1);
                --shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
                --radius: 12px;
                --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            html, body {
                overflow: hidden;
                background-color: var(--primary-bg);
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                color: var(--text-primary);
                height: 100%;
                margin: 0;
            }

            canvas {
                width: 100%;
                height: 100%;
                display: block;
            }

            /* Modern Control Panel */
            .control-panel {
                position: fixed;
                bottom: 20px;
                left: 20px;
                width: 360px;
                max-height: 80vh;
                backdrop-filter: blur(40px);
                -webkit-backdrop-filter: blur(40px);
                background: rgba(0, 0, 0, 0.4);
                border: 1px solid var(--border-color);
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                z-index: 1000;
                overflow: hidden;
                overflow-x: hidden; /* Prevent horizontal scrolling */
                transition: var(--transition);
            }

            .control-panel.collapsed {
                height: 50px;
                overflow: hidden;
            }

            /* Header */
            .panel-header {
                padding: 15px 20px;
                backdrop-filter: blur(40px);
                -webkit-backdrop-filter: blur(40px);
                /* background: rgba(0, 0, 0, 0.3); */
                color: white;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: var(--transition);
            }

            .panel-header:hover {
                background: rgba(255, 255, 255, 0.05);
            }

            .panel-header .toggle-icon {
                transition: var(--transition);
                font-size: 12px;
            }

            .control-panel.collapsed .panel-header .toggle-icon {
                transform: rotate(180deg);
            }

            /* Content */
            .panel-content {
                padding: 20px 30px 30px 50px;
                max-height: calc(80vh - 50px);
                overflow-y: auto;
                overflow-x: hidden; /* Prevent horizontal scrolling */
                scrollbar-width: thin;
                scrollbar-color: var(--accent-color) transparent;
            }

            .panel-content::-webkit-scrollbar {
                width: 6px;
            }

            .panel-content::-webkit-scrollbar-track {
                background: transparent;
            }

            .panel-content::-webkit-scrollbar-thumb {
                background: var(--accent-color);
                border-radius: 3px;
            }

            /* Control Groups */
            .control-group:last-child {
                margin-bottom: 0;
            }

            .group-title {
                font-size: 13px;
                font-weight: 600;
                color: var(--text-secondary);
                text-transform: uppercase;
                letter-spacing: 0.8px;
                margin: 20px 0 16px 0;
                padding-bottom: 8px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            }

            /* Modern Sliders */
            .control-item {
                margin-top: 16px;
                /* margin-bottom: 16px; */
            }

            .control-label {
                display: block;
                font-size: 13px;
                font-weight: 500;
                color: var(--text-primary);
                margin-bottom: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .control-value {
                font-size: 12px;
                color: var(--accent-color);
                font-weight: 600;
                background: rgba(6, 163, 215, 0.1);
                padding: 2px 8px;
                border-radius: 4px;
            }
            .control-value.number-input {
                width: 45px;
                border: none;
                text-align: center;
                margin-left: 4px;
                outline: none;
            }

            .slider-container {
                position: relative;
                height: 6px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border-radius: 3px;
                cursor: pointer;
                transition: var(--transition);
                margin: 20px 0;
            }

            .slider-container:hover {
                background: rgba(60, 60, 70, 0.9);
            }

            .slider-fill {
                height: 100%;
                background: var(--accent-color);
                border-radius: 3px;
                transition: width 0.05s ease-out;
                position: relative;
            }

            .slider-handle {
                position: absolute;
                right: -8px;
                top: 50%;
                transform: translateY(-50%);
                width: 16px;
                height: 16px;
                background: white;
                border: 2px solid var(--accent-color);
                border-radius: 50%;
                cursor: pointer;
                transition: transform 0.05s ease-out, box-shadow 0.05s ease-out;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }

            .slider-handle:hover {
                transform: translateY(-50%) scale(1.2);
                box-shadow: 0 4px 12px rgba(6, 163, 215, 0.4);
            }

            /* Modern Toggles */
            .toggle-container {
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: var(--transition);
                /* padding: 8px 4px; */
                /* min-height: 44px; */
            }

            .toggle-container:hover {
                opacity: 0.8;
            }

            .toggle-container span {
                font-size: 13px;
                font-weight: 500;
            }

            .toggle-switch {
                width: 44px;
                height: 24px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border-radius: 12px;
                position: relative;
                transition: var(--transition);
                border: 1px solid var(--border-color);
            }

            .toggle-switch.active {
                background: var(--accent-color);
                border-color: var(--accent-color);
            }

            .toggle-handle {
                width: 18px;
                height: 18px;
                background: white;
                border-radius: 50%;
                position: absolute;
                top: 2px;
                left: 2px;
                transition: var(--transition);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .toggle-switch.active .toggle-handle {
                transform: translateX(20px);
            }

            /* Advanced Section */
            .advanced-section {
                margin-top: 8px;
            }

            .advanced-toggle {
                cursor: pointer;
                padding: 12px 8px;
                font-size: 14px;
                font-weight: 500;
                color: var(--text-secondary);
                display: flex;
                align-items: center;
                gap: 10px;
                transition: var(--transition);
                border-radius: 6px;
                margin: -4px -8px;
                position: relative;
            }

            .advanced-toggle:hover {
                color: var(--accent-color);
                background: rgba(255, 255, 255, 0.05);
            }
            
            
            .toggle-icon {
                transition: var(--transition);
                font-size: 12px;
                width: 16px;
                text-align: center;
            }
            
            @media (max-width: 768px) {
                .advanced-toggle {
                    padding: 16px 12px;
                    font-size: 15px;
                    gap: 12px;
                    margin: -8px -12px;
                    min-height: 48px; /* Larger touch target */
                    border-radius: 8px;
                }
                
                .toggle-icon {
                    font-size: 14px;
                    width: 18px;
                }
                
                /* Touch feedback */
                .advanced-toggle:active {
                    background: rgba(6, 163, 215, 0.1);
                    transform: scale(0.98);
                    transition: all 0.1s ease;
                }
            }

            .advanced-content {
                max-height: 0;
                overflow: hidden;
                transition: var(--transition);
                position: relative;
            }

            .advanced-content.expanded {
                max-height: none; /* Remove height restriction to show all content */
                margin-top: 16px;
            }
            
            /* Ensure QR content is properly contained */
            #telegramQRContent {
                position: relative;
                width: 100%;
            }
            

            /* Button */
            .modern-button {
                width: 100%;
                padding: 12px;
                background: var(--accent-color);
                border: none;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                font-size: 13px;
                cursor: pointer;
                transition: var(--transition);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .modern-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(6, 163, 215, 0.3);
            }

            .modern-button:active {
                transform: translateY(0);
            }

            /* QR Code Container Styling */
            .qr-code-container {
                display: flex;
                justify-content: center;
                align-items: center;
                /* padding: 24px; */
                background: white;
                border-radius: 16px;
                margin: 12px 0;
                position: relative;
                width: 100%;
                box-sizing: border-box;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            }
            
            #telegramQRCanvas {
                max-width: 300px;
                /* width: auto; */
                /* height: auto; */
                display: block;
                position: relative;
                border-radius: 12px;
                background: white;
                padding: 12px;
                box-sizing: border-box;
                /* box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); */
                /* border: 2px solid rgba(255, 255, 255, 0.9); */
            }

            /* Mobile Responsive */
            @media (max-width: 768px) {
                body {
                    /* Prevent scrolling issues on mobile */
                    overflow: hidden;
                    position: fixed;
                    width: 100%;
                    height: 100%;
                }

                canvas {
                    /* Ensure canvas takes full viewport */
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw !important;
                    height: 100vh !important;
                    touch-action: none; /* Prevent scrolling and zooming */
                }

                .control-panel {
                    /* Portrait mode: full width at bottom with finger-width padding */
                    position: fixed;
                    bottom: 0;
                    left: 20px; /* Finger-width padding */
                    right: 20px; /* Finger-width padding */
                    width: calc(100% - 40px); /* Adjust width for padding */
                    max-height: 85vh; /* Increased from 70vh to allow more content */
                    border-radius: 16px 16px 0 0;
                    border-bottom: none;
                    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
                }

                .panel-content {
                    padding: 12px 50px 30px 50px;
                    max-height: calc(85vh - 40px); /* Adjusted for 20px padding (20px top + 20px bottom) */
                    overflow-y: auto;
                    overflow-x: hidden; /* Prevent horizontal scrolling */
                    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
                    scrollbar-width: thin; /* Firefox */
                    scrollbar-color: rgba(255, 255, 255, 0.3) transparent; /* Firefox */
                    /* Ensure content can be scrolled */
                    height: auto;
                    min-height: 0;
                }

                /* Webkit scrollbar styling for mobile */
                .panel-content::-webkit-scrollbar {
                    width: 4px;
                }

                .panel-content::-webkit-scrollbar-track {
                    background: transparent;
                }

                .panel-content::-webkit-scrollbar-thumb {
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 2px;
                }

                .panel-content::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.5);
                }

                .slider-handle {
                    width: 22px;
                    height: 22px;
                    right: -11px;
                }

                .toggle-switch {
                    width: 54px;
                    height: 30px;
                }

                .toggle-handle {
                    width: 24px;
                    height: 24px;
                    top: 3px;
                }

                .toggle-switch.active .toggle-handle {
                    transform: translateX(22px);
                }

                /* Larger touch targets for mobile */
                .control-item {
                    padding: 8px 0;
                    margin-top: 8px;
                    min-height: 44px; /* iOS recommended touch target */
                }

                .slider-container {
                    height: 6px;
                    margin: 12px 0;
                }

                .toggle-container {
                    min-height: 44px;
                    align-items: center;
                }

                /* Better text sizing for mobile */
                .control-label {
                    font-size: 16px;
                }

                .control-value {
                    font-size: 16px;
                }

                .group-title {
                    font-size: 18px;
                    margin: 12px 0 8px 0;
                }
                
                /* Reduce spacing for advanced sections on mobile */
                .advanced-section {
                    margin-top: 4px;
                }
                
                .advanced-content.expanded {
                    margin-top: 8px;
                }
            }

            /* Mobile Landscape */
            @media (max-width: 768px) and (orientation: landscape) {
                .control-panel {
                    /* Landscape mode: side panel with finger-width padding */
                    position: fixed;
                    top: 20px; /* Finger-width padding from top */
                    right: 20px; /* Finger-width padding from right */
                    bottom: 20px; /* Finger-width padding from bottom */
                    left: auto;
                    width: 400px;
                    max-height: calc(100vh - 40px); /* Adjust for top/bottom padding */
                    border-radius: 16px;
                    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
                }

                .panel-content {
                    max-height: calc(100vh - 80px); /* Adjusted for 20px padding (top/bottom) + 40px panel padding (top/bottom) */
                }

                canvas {
                    width: calc(100vw - 360px) !important; /* Account for panel width (320px) + right padding (20px) + panel left margin from canvas (20px) */
                }
            }

            /* Small mobile devices */
            @media (max-width: 480px) {
                .control-panel {
                    max-height: 90vh; /* Maximum space for controls on small screens */
                    /* Improve touch interactions */
                    -webkit-tap-highlight-color: transparent;
                    touch-action: manipulation;
                }
                
                /* Improve button touch targets */
                .modern-button {
                    min-height: 44px;
                    touch-action: manipulation;
                    -webkit-tap-highlight-color: transparent;
                    -webkit-user-select: none;
                    user-select: none;
                }
                
                /* Reduce spacing between input buttons on mobile */
                .modern-button.secondary {
                    margin-top: 4px;
                }
                
                .panel-header {
                    /* background: rgba(0, 0, 0, 0.3); */
                    min-height: 44px;
                    touch-action: manipulation;
                    -webkit-tap-highlight-color: transparent;
                    -webkit-user-select: none;
                    user-select: none;
                }
                
                .advanced-toggle {
                    min-height: 44px;
                    touch-action: manipulation;
                    -webkit-tap-highlight-color: transparent;
                    -webkit-user-select: none;
                    user-select: none;
                }

                .panel-content {
                    padding: 8px 50px 25px 50px;
                    max-height: calc(90vh - 40px); /* Adjusted for 20px padding (20px top + 20px bottom) */
                    overflow-y: auto;
                    overflow-x: hidden; /* Prevent horizontal scrolling */
                    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
                    /* Ensure content can be scrolled */
                    height: auto;
                    min-height: 0;
                }
                
                /* Further reduce spacing on small screens */
                .control-item {
                    padding: 6px 0;
                    margin-top: 6px;
                }
                
                .group-title {
                    margin: 8px 0 6px 0;
                    font-size: 16px;
                }
                
                .slider-container {
                    margin: 8px 0;
                }
                
                .advanced-section {
                    margin-top: 2px;
                }
                
                .advanced-content.expanded {
                    margin-top: 6px;
                }

                .color-row {
                    flex-direction: column;
                    gap: 14px;
                }

                .color-container {
                    min-width: 100%;
                    justify-content: space-between;
                }
                
                .color-input {
                    width: 36px;
                    height: 36px;
                }
                
                .clr-field button {
                    width: 36px !important;
                    height: 36px !important;
                }

                .control-label {
                    font-size: 14px;
                }

                .control-value {
                    font-size: 14px;
                }

                .group-title {
                    font-size: 16px;
                }
            }

            /* Animations */
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .control-panel {
                animation: fadeIn 0.5s ease-out;
            }

            /* Scroll to Bottom/Top Button */
            .scroll-button {
                position: absolute;
                bottom: 10px;
                left: 10px;
                width: 27px;
                height: 27px;
                background: var(--accent-color);
                border: none;
                border-radius: 6px;
                color: white;
                font-size: 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: var(--transition);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                opacity: 0.8;
            }

            .scroll-button:hover {
                opacity: 1;
                transform: scale(1.1);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            }

            .scroll-button:active {
                transform: scale(0.95);
            }

            /* Hide scroll button when panel is collapsed */
            .control-panel.collapsed .scroll-button {
                display: none;
            }

            /* Mobile responsive scroll button */
            @media (max-width: 768px) {
                .scroll-button {
                    width: 24px;
                    height: 24px;
                    font-size: 10px;
                    bottom: 10px;
                    left: 10px;
                }
            }

            /* Hide promo popup for clean experience */
            .promo {
                display: none !important;
            }

            /* Input Styles */
            .api-input, .text-input {
                width: 100%;
                padding: 8px 12px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border: 1px solid var(--border-color);
                border-radius: 6px;
                color: var(--text-primary);
                font-size: 13px;
                font-family: inherit;
                transition: var(--transition);
                margin-bottom: 8px;
            }

            .api-input:focus, .text-input:focus {
                outline: none;
                border-color: var(--accent-color);
                box-shadow: 0 0 0 2px rgba(6, 163, 215, 0.2);
            }

            .api-input::placeholder, .text-input::placeholder {
                color: var(--text-secondary);
            }

            /* Textarea Container */
            .textarea-container {
                position: relative;
                width: 100%;
            }

            .textarea-container .text-input {
                padding-right: 40px; /* Make room for paste button */
                margin-bottom: 8px;
            }

            /* Paste Button */
            .paste-button {
                position: absolute;
                top: 8px;
                right: 8px;
                width: 24px;
                height: 24px;
                background: rgba(6, 163, 215, 0.1);
                border: 1px solid rgba(6, 163, 215, 0.3);
                border-radius: 4px;
                color: var(--accent-color);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                transition: var(--transition);
                z-index: 10;
            }

            .paste-button:hover {
                background: rgba(6, 163, 215, 0.2);
                border-color: var(--accent-color);
            }

            .paste-button:active {
                background: rgba(6, 163, 215, 0.3);
                transform: scale(0.95);
            }
            
            /* Console Command Text */
            .console-command-text {
                font-size: 0.8rem;
                color: var(--text-secondary);
                margin-top: 8px;
                cursor: pointer;
                transition: color 0.2s ease;
                line-height: 1.4;
            }
            
            .console-command-text:hover {
                color: var(--text-primary);
            }
            
            .console-command-text code {
                background: rgba(255, 255, 255, 0.1);
                padding: 2px 4px;
                border-radius: 3px;
                font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
                font-size: 0.75rem;
                font-weight: bold;
                color: #06a3d7;
            }
            
            .console-command-text.copied {
                color: #22c55e;
                font-weight: 500;
            }
            
            /* Auto-resize Textarea */
            .auto-resize-textarea {
                min-height: 40px;
                max-height: 120px;
                resize: none;
                overflow-y: auto;
                line-height: 1.4;
                transition: height 0.2s ease;
            }
            
            @media (max-width: 768px) {
                .auto-resize-textarea {
                    min-height: 44px; /* Larger touch target on mobile */
                    max-height: 140px;
                    font-size: 16px; /* Prevent zoom on iOS */
                }
            }

            /* Unified Preset Buttons */
            .preset-buttons {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
                gap: 10px;
                margin-top: 12px;
            }
            
            /* Prompt Preset Grid - Optimized Layout */
            .prompt-preset-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr); /* 2 columns for better spacing */
                gap: 12px;
                margin-top: 12px;
            }

            .preset-btn,
            .preset-button {
                padding: 10px 14px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                color: var(--text-primary);
                font-size: 12px;
                font-weight: 500;
                font-family: inherit;
                cursor: pointer;
                transition: var(--transition);
                text-align: center;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .preset-btn:hover,
            .preset-button:hover {
                background: var(--accent-color);
                border-color: var(--accent-color);
                color: white;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(6, 163, 215, 0.3);
            }

            .preset-btn:active,
            .preset-button:active {
                transform: translateY(0);
                box-shadow: 0 2px 6px rgba(6, 163, 215, 0.2);
            }

            .preset-button.active {
                background: var(--accent-color);
                border-color: var(--accent-color);
                color: white;
                box-shadow: 0 2px 8px rgba(6, 163, 215, 0.4);
            }

            @media (max-width: 768px) {
                .preset-buttons {
                    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                    gap: 12px;
                }
                
                .prompt-preset-grid {
                    grid-template-columns: repeat(2, 1fr); /* Keep 2 columns on mobile */
                    gap: 12px;
                }
                
                .preset-btn,
                .preset-button {
                    padding: 14px 16px;
                    font-size: 13px;
                    min-height: 48px; /* Larger touch target */
                    border-radius: 10px;
                }
                
                /* Touch feedback */
                .preset-btn:active,
                .preset-button:active {
                    transform: scale(0.98);
                    transition: transform 0.1s ease;
                }
            }
            
            @media (max-width: 480px) {
                .prompt-preset-grid {
                    grid-template-columns: 1fr; /* Single column on very small screens */
                    gap: 10px;
                }
            }

            /* Stream Status */
            .stream-status {
                font-size: 12px;
                padding: 2px 8px;
                border-radius: 4px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .stream-status.idle {
                background: rgba(128, 128, 128, 0.2);
                color: #888;
            }

            .stream-status.connecting {
                background: rgba(255, 165, 0, 0.2);
                color: #ffa500;
            }

            .stream-status.active {
                background: rgba(0, 255, 0, 0.2);
                color: #00ff00;
            }

            .stream-status.error {
                background: rgba(255, 0, 0, 0.2);
                color: #ff0000;
            }
            


            /* Stream Button States */
            .modern-button.streaming {
                background: #ff4444;
            }
            
            .modern-button.secondary {
                background: #666666;
                margin-top: 8px;
            }

            .modern-button.secondary:hover {
                background: #777777;
                box-shadow: 0 6px 20px rgba(119, 119, 119, 0.3);
            }
            
            .modern-button.secondary.copied {
                background: #22c55e;
                color: white;
            }

            .modern-button.streaming:hover {
                background: #cc3333;
            }

            .modern-button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none !important;
            }

            /* Coloris Integration */
            .color-input {
                width: 40px;
                height: 40px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 4px;
                background: var(--control-bg);
                color: transparent;
                cursor: pointer;
                transition: all 0.2s ease;
                padding: 0;
                font-size: 12px;
                text-align: center;
                font-weight: 500;
                caret-color: transparent;
            }

            .color-input:hover {
                border-color: rgba(255, 255, 255, 0.8);
                transform: scale(1.02);
            }

            .color-input:focus {
                border-color: rgba(255, 255, 255, 0.8);
                outline: none;
                box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
            }

            /* Mobile keyboard prevention */
            .color-input[readonly] {
                cursor: pointer;
                opacity: 1;
                background-color: var(--control-bg);
                user-select: none;
                -webkit-user-select: none;
                -webkit-touch-callout: none;
            }

            .color-input[inputmode="none"] {
                caret-color: transparent;
            }

            /* Full-size thumbnail (from Coloris examples) */
            .full .clr-field button {
                width: 40px !important;
                height: 40px !important;
                border-radius: 4px;
            }
            
            .clr-field button {
                width: 40px !important;
                height: 40px !important;
                border-radius: 4px !important;
            }

            /* Color label styling */
            .color-label {
                font-size: 13px;
                font-weight: 500;
            }

            /* Hide text input inside the Coloris picker */
            .clr-picker input.clr-color {
                display: none !important;
            }

            /* Hide format toggle buttons if present */
            .clr-picker .clr-format {
                display: none !important;
            }

            /* Hide the center preview dot completely */
            .clr-picker .clr-preview {
                display: none !important;
            }

            /* Compact layout - reduce spacing between elements */
            .clr-picker .clr-gradient {
                margin-bottom: 8px !important;
            }

            .clr-picker .clr-hue {
                margin: 3px 20px !important;
            }

            .clr-picker .clr-alpha {
                margin: 3px 20px !important;
            }

            .clr-picker .clr-swatches {
                margin: 8px 16px 12px 16px !important;
                display: block !important;
                visibility: visible !important;
            }

            .clr-picker .clr-swatches div {
                padding-bottom: 6px !important;
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 2px !important;
            }

            /* Completely hide the text input field appearance */
            .color-input {
                /* Hide all text and visual elements */
                color: transparent !important;
                text-shadow: none !important;
                background: transparent !important;
                border: none !important;
                outline: none !important;
                box-shadow: none !important;
                /* Make text completely invisible */
                font-size: 0 !important;
                line-height: 0 !important;
                text-indent: -9999px !important;
                /* Remove all padding and spacing */
                padding: 0 !important;
                margin: 0 !important;
                /* Ensure no visual feedback */
                opacity: 0 !important;
                /* Keep clickable area for Coloris */
                pointer-events: auto !important;
                position: relative !important;
            }

            .color-row {
                display: flex;
                flex-direction: column;
                gap: 8px;
                /* margin-bottom: 20px; */
            }

            .color-container {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 16px;
                /* padding: 8px 4px; */
                min-height: 44px;
            }

            .color-label {
                font-size: 13px;
                font-weight: 500;
                color: var(--text-primary);
                white-space: nowrap;
                flex: 1;
            }

            /* Coloris Dark Theme Customization */
            .clr-picker {
                background: var(--secondary-bg) !important;
                border: 2px solid rgba(255, 255, 255, 0.5) !important;
                border-radius: 12px !important;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5) !important;
            }

            .clr-gradient, .clr-color, .clr-alpha {
                border-radius: 6px !important;
            }

            .clr-hue, .clr-alpha {
                border-radius: 6px !important;
            }

            .clr-field button {
                border-radius: 6px !important;
                border: 2px solid var(--border-color) !important;
            }

            .clr-field button:hover {
                border-color: var(--accent-color) !important;
            }

            .clr-swatches {
                background: none !important;
                padding: 8px !important;
                border-radius: 8px !important;
                border: none !important;
                display: block !important;
                visibility: visible !important;
            }

            .clr-swatches button {
                border-radius: 4px !important;
                margin: 2px !important;
                border: 1px solid rgba(255, 255, 255, 0.5) !important;
                width: 24px !important;
                height: 24px !important;
                background-image: none !important;
                display: inline-block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            .clr-swatches button:hover {
                transform: scale(1.1) !important;
                border-color: var(--accent-color) !important;
                box-shadow: 0 0 8px rgba(6, 163, 215, 0.4) !important;
            }

            /* Stream Overlay Styles */
            .stream-overlay {
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: calc(100vh - 40px);
                height: calc(100vh - 40px);
                background: transparent;
                border: none;
                border-radius: 12px;
                box-shadow: none;
                z-index: 1000;
                display: none;
                overflow: hidden;
                pointer-events: none;
            }

            .stream-overlay.visible {
                display: block;
            }

            .stream-overlay-content {
                width: 100%;
                height: 100%;
                position: relative;
                pointer-events: none;
            }

            .stream-overlay iframe {
                width: 100%;
                height: 100%;
                border: none;
                border-radius: 12px;
                pointer-events: none;
                opacity: 0.8;
                transition: opacity 0.3s ease;
            }

            /* Hide video UI elements with CSS overlay */
            .stream-overlay-content::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 60px;
                background: transparent;
                pointer-events: none;
                z-index: 10;
            }

            /* Solid overlay to completely hide video UI controls */


            .stream-overlay-loading {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: var(--text-secondary);
                font-size: 14px;
                text-align: center;
            }

            /* Stream Control Buttons Row */
            .stream-controls-row {
                display: flex;
                flex-direction: row;
                gap: 8px;
                align-items: center;
                justify-content: flex-start;
                margin-top: 12px;
            }

            .stream-control-button {
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 36px;
                height: 36px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: var(--text-primary);
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 14px;
            }

            .stream-control-button:hover {
                background: rgba(255, 255, 255, 0.2);
                border-color: var(--accent-color);
                transform: scale(1.05);
            }

            .stream-control-button.primary {
                background: rgba(255, 255, 255, 0.15);
                border-color: rgba(255, 255, 255, 0.3);
                color: #fff;
                flex: 1;
                justify-content: flex-start;
                padding: 0 12px;
                gap: 8px;
                font-weight: 600;
                width: 100%;
                min-width: 0;
            }

            .stream-control-button.primary:hover {
                background: rgba(255, 255, 255, 0.25);
                border-color: rgba(255, 255, 255, 0.4);
            }

            /* Tooltip System */
            .tooltip {
                position: relative;
                display: inline-block;
            }

            .tooltip .tooltiptext {
                visibility: hidden;
                width: max-content;
                max-width: 200px;
                background-color: rgba(0, 0, 0, 0.9);
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 6px 10px;
                font-size: 11px;
                font-weight: 500;
                position: absolute;
                z-index: 1001;
                bottom: 110%;
                left: 50%;
                transform: translateX(-50%);
                opacity: 0;
                transition: opacity 0.2s, visibility 0.2s;
                pointer-events: none;
                white-space: nowrap;
            }

            /* Tooltip inside button positioning - new approach */
            .stream-control-button {
                position: relative;
            }

            .stream-control-button .tooltiptext {
                visibility: hidden;
                width: max-content;
                max-width: 200px;
                background-color: rgba(0, 0, 0, 0.9);
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 6px 10px;
                font-size: 11px;
                font-weight: 500;
                position: fixed;
                z-index: 1001;
                opacity: 0;
                transition: opacity 0.2s, visibility 0.2s;
                pointer-events: none;
                white-space: nowrap;
                display: none; /* Ensure tooltip is completely hidden by default */
            }

            .stream-control-button .tooltiptext::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
            }

            .stream-control-button:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
                display: block;
            }

            /* Hide scrollbar for OSC messages */
            #oscMessages::-webkit-scrollbar {
                display: none;
            }

            /* Hide scrollbar for Telegram messages */
            #telegramMessages::-webkit-scrollbar {
                display: none;
            }

            /* Hide scrollbar for Daydream messages */
            #daydreamMessages::-webkit-scrollbar {
                display: none;
            }

            .tooltip .tooltiptext::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
            }

            .tooltip:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
            }

            /* Position hex input to the left of color preview */
            .clr-field {
                display: flex !important;
                flex-direction: row-reverse !important;
                align-items: center !important;
                gap: 12px !important;
            }

            .clr-field input {
                background: var(--control-bg) !important;
                border: 1px solid rgba(255, 255, 255, 0.5) !important;
                border-radius: 6px !important;
                color: var(--text-primary) !important;
                padding: 6px 8px !important;
                font-size: 12px !important;
                width: 80px !important;
            }

            .clr-field input:focus {
                border-color: var(--accent-color) !important;
                outline: none !important;
                box-shadow: 0 0 0 2px rgba(6, 163, 215, 0.2) !important;
            }

            /* Remove background images from all color picker elements */
            .clr-field button, .clr-color, .clr-alpha, .clr-preview:before, .clr-preview:after {
                background-image: none !important;
            }

            /* Checkbox Styles */
            .checkbox-container {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-top: 8px;
            }

            .checkbox-input {
                width: 16px;
                height: 16px;
                accent-color: var(--accent-color);
                cursor: pointer;
                margin: 0;
                vertical-align: middle;
            }

            .checkbox-label {
                font-size: 12px;
                color: var(--text-secondary);
                cursor: pointer;
                user-select: none;
                line-height: 16px;
                vertical-align: middle;
            }

            .checkbox-label:hover {
                color: var(--text-primary);
            }

            /* Secondary Button */
            .modern-button.secondary {
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
            }

            .modern-button.secondary:hover {
                background: rgba(60, 60, 70, 0.9);
                border-color: var(--accent-color);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }

            .modern-button.secondary.active {
                background: var(--accent-color);
                border-color: var(--accent-color);
                color: var(--text-primary);
            }

            /* Tablet Optimized Button */
            .tablet-optimized-button {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 48px; /* Larger touch target for tablets */
                min-width: 120px;
                padding: 12px 20px;
                cursor: pointer;
                user-select: none;
                -webkit-user-select: none;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
                transition: all 0.2s ease;
                border: 2px solid transparent;
                text-align: center; /* Center text and icons */
            }

            .tablet-optimized-button:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }

            .tablet-optimized-button:active {
                transform: translateY(0);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
                background: rgba(60, 60, 70, 0.9);
            }

            .tablet-optimized-button:focus {
                outline: 2px solid var(--accent-color);
                outline-offset: 2px;
            }

            .tablet-optimized-button i {
                margin-right: 8px;
            }


            /* Telegram Bot Link */
            .telegram-bot-link {
                font-size: 11px;
                color: var(--text-secondary);
                text-decoration: none;
                opacity: 0.7;
                transition: opacity 0.3s ease;
                display: inline-flex;
                align-items: center;
            }

            .telegram-bot-link:hover {
                opacity: 1;
                color: var(--accent-color);
                text-decoration: none;
            }

            /* Keyboard Hint */
            .keyboard-hint {
                font-size: 12px;
                opacity: 0.6;
                margin-left: 8px;
                cursor: help;
                transition: var(--transition);
            }

            .keyboard-hint:hover {
                opacity: 1;
            }

            /* ControlNet Preset Grid - Special 2x2 Layout */
            .controlnet-preset-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-top: 12px;
            }
            
            @media (max-width: 768px) {
                .controlnet-preset-buttons {
                    gap: 12px;
                }
                
                .controlnet-preset-buttons .preset-button {
                    min-height: 48px;
                    padding: 14px 12px;
                    font-size: 12px;
                }
            }

            /* Image Upload Styles */
            .image-upload-container {
                display: flex;
                flex-direction: column;
                gap: 8px;
                margin-top: 8px;
            }

            .image-upload-container .modern-button {
                font-size: 12px;
                padding: 6px 12px;
                height: auto;
            }

            .image-preview {
                margin-top: 8px;
                border: 1px solid var(--border-color);
                border-radius: var(--radius);
                padding: 8px;
                background: rgba(0, 0, 0, 0.3);
            }

            .image-preview img {
                max-width: 100%;
                max-height: 80px;
                border-radius: 4px;
                display: block;
                margin: 0 auto;
            }
            
            .camera-preview {
                margin-top: 8px;
                border: 1px solid var(--border-color);
                border-radius: var(--radius);
                padding: 8px;
                background: rgba(0, 0, 0, 0.3);
                position: relative;
            }
            
            .camera-preview video {
                max-width: 100%;
                max-height: 80px;
                border-radius: 4px;
                display: block;
                margin: 0 auto;
            }
            
            .camera-preview::after {
                content: " LIVE";
                position: absolute;
                top: 12px;
                right: 12px;
                background: rgba(255, 0, 0, 0.9);
                color: white;
                padding: 2px 6px;
                border-radius: 3px;
                font-size: 10px;
                font-weight: bold;
                text-shadow: 0 1px 2px rgba(0,0,0,0.8);
                z-index: 10;
            }

            @media (max-width: 768px) {
                .image-upload-container {
                    gap: 6px;
                }
                
                .image-preview img, .camera-preview video {
                    max-height: 60px;
                }
            }

            /* Simple Tooltip System - W3Schools Style */
            .tooltip {
                position: relative;
                display: inline;
                cursor: help;
            }

            .info-icon {
                display: inline-block;
                width: 18px;
                height: 18px;
                margin-left: 4px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                text-align: center;
                line-height: 16px;
                font-size: 11px;
                font-weight: 600;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                color: rgba(255, 255, 255, 0.9);
                cursor: help;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .info-icon:hover,
            .tooltip.mobile-active .info-icon {
                background: linear-gradient(135deg, rgba(100, 200, 255, 0.4), rgba(100, 200, 255, 0.2));
                border-color: rgba(100, 200, 255, 0.6);
                color: rgba(255, 255, 255, 1);
                transform: scale(1.15);
                box-shadow: 
                    0 4px 12px rgba(100, 200, 255, 0.3),
                    0 2px 6px rgba(0, 0, 0, 0.2);
            }

            /* Tooltip text */
            .tooltiptext {
                visibility: hidden;
                width: 160px; /* Reduced from 220px to fit within panel */
                max-width: 160px;
                background-color: rgba(20, 25, 35, 0.95);
                backdrop-filter: blur(10px);
                color: rgba(255, 255, 255, 0.95);
                text-align: left;
                border-radius: 8px;
                white-space: normal; /* Allow multi-line text */
                word-wrap: break-word; /* Break long words */
                padding: 8px 12px;
                font-size: 11px;
                line-height: 1.4;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                word-wrap: break-word; /* Ensure long words wrap */

                /* Position the tooltip above to avoid overflow */
                position: absolute;
                z-index: 9999;
                bottom: 100%;
                left: 50%;
                margin-left: -80px; /* Half of tooltip width for centering */
                margin-bottom: 8px;

                /* Fade in tooltip */
                opacity: 0;
                transition: opacity 0.3s;
            }

            /* Tooltip arrow pointing down */
            .tooltiptext::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: rgba(20, 25, 35, 0.95) transparent transparent transparent;
            }

            /* Show the tooltip text when you mouse over the tooltip container */
            .tooltip:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
            }

            /* Mobile adjustments for tooltips */
            @media (max-width: 768px) {
                .info-icon {
                    width: 24px; /* Larger touch target */
                    height: 24px;
                    line-height: 22px;
                    font-size: 12px;
                    margin-left: 6px;
                }
                
                .tooltiptext {
                    width: 200px; /* Wider for better readability */
                    max-width: calc(100vw - 40px); /* Account for panel padding */
                    font-size: 13px;
                    padding: 12px 16px;
                    line-height: 1.5;
                    /* Better mobile positioning */
                    top: auto;
                    left: 50%;
                    bottom: 100%;
                    margin-left: -100px; /* Half of width for centering */
                    margin-top: 0;
                    margin-bottom: 12px;
                    /* Ensure tooltip stays within viewport */
                    transform: translateX(0);
                }
                
                /* Adjust tooltip position if it would go off-screen */
                .tooltiptext.adjust-left {
                    left: 20px;
                    margin-left: 0;
                }
                
                .tooltiptext.adjust-right {
                    right: 20px;
                    left: auto;
                    margin-left: 0;
                }
                
                /* Arrow points down on mobile */
                .tooltiptext::after {
                    top: 100%;
                    right: auto;
                    left: 50%;
                    margin-left: -5px;
                    margin-top: 0;
                    border-color: rgba(20, 25, 35, 0.95) transparent transparent transparent;
                }
                
                /* Active state for mobile tooltips */
                .tooltip.mobile-active .tooltiptext {
                    visibility: visible;
                    opacity: 1;
                }
                
                /* Disable hover on mobile to prevent conflicts */
                .tooltip:hover .tooltiptext {
                    visibility: hidden;
                    opacity: 0;
                }
                
                .tooltip.mobile-active:hover .tooltiptext {
                    visibility: visible;
                    opacity: 1;
                }
            }

            /* Keyboard Shortcuts Info */
            .keyboard-shortcuts-info {
                margin-top: 8px;
            }

            /* Tablet Shortcuts Info */
            .tablet-shortcuts-info {
                margin-top: 8px;
            }

            .shortcut-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 12px;
                color: var(--text-secondary);
                margin-bottom: 4px;
            }

            .shortcut-item span:first-child {
                font-weight: 600;
                color: var(--accent-color);
            }

            /* Welcome Overlay Styles */
            .welcome-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(40px);
                -webkit-backdrop-filter: blur(40px);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: fadeIn 0.5s ease-out;
            }

            .welcome-content {
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border-radius: var(--radius);
                padding: 30px;
                max-width: 750px;
                width: 100%;
                max-height: 95vh;
                overflow-y: auto;
                box-shadow: var(--shadow);
                border: 1px solid var(--border-color);
                text-align: center;
                /* Hide scrollbar */
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* Internet Explorer 10+ */
                user-select: text;
                -webkit-user-select: text;
                -moz-user-select: text;
                -ms-user-select: text;
            }

            .welcome-content::-webkit-scrollbar {
                display: none; /* Safari and Chrome */
            }

            .welcome-header h1 {
                color: var(--text-primary);
                font-size: 2rem;
                margin-bottom: 8px;
                color: var(--accent-color);
            }

            .welcome-subtitle {
                color: var(--text-secondary);
                font-size: 1rem;
                margin-bottom: 25px;
                line-height: 1.4;
            }

            .features-title {
                color: var(--text-primary);
                font-size: 1.5rem;
                font-weight: 600;
                margin-bottom: 20px;
                text-align: center;
                color: var(--accent-color);
            }

            .feature-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
                margin-bottom: 25px;
            }

            .feature-item {
                background: rgb(182 182 204 / 6%);
                backdrop-filter: blur(60px);
                border-radius: 16px;
                padding: 20px;
                border: 1px solid var(--border-color);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
            }

            .feature-item::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: var(--accent-color);
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .feature-item.primary {
                background: rgba(6, 163, 215, 0.08);
                border-color: rgba(6, 163, 215, 0.3);
            }

            .feature-item.primary::before {
                opacity: 1;
            }

            .feature-item:hover {
                transform: translateY(-4px) scale(1.02);
                box-shadow: 0 12px 40px rgba(6, 163, 215, 0.2);
                border-color: rgba(6, 163, 215, 0.4);
            }

            .feature-item:hover::before {
                opacity: 1;
            }

            .feature-icon {
                font-size: 2rem;
                margin-bottom: 12px;
                color: #06a3d7;
                transition: all 0.3s ease;
            }

            .feature-item:hover .feature-icon {
                transform: scale(1.1);
                color: var(--accent-hover);
            }

            .feature-item h3 {
                color: var(--text-primary);
                font-size: 1.2rem;
                font-weight: 700;
                margin-bottom: 10px;
                line-height: 1.2;
                letter-spacing: -0.02em;
            }

            .feature-description {
                color: var(--text-secondary);
                font-size: 0.95rem;
                line-height: 1.5;
                margin-bottom: 16px;
                opacity: 0.95;
                font-weight: 400;
            }


            .welcome-api-section {
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border-radius: var(--radius);
                padding: 20px;
                margin: 20px 0;
                border: 1px solid var(--border-color);
            }

            .welcome-api-section h3 {
                color: var(--text-primary);
                margin-bottom: 12px;
                font-size: 1.2rem;
            }

            .welcome-api-section p {
                color: var(--text-secondary);
                margin-bottom: 15px;
                line-height: 1.4;
                font-size: 0.95rem;
            }

            .api-links {
                display: flex;
                gap: 12px;
                justify-content: center;
                margin-bottom: 18px;
                flex-wrap: wrap;
            }

            .api-link {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 10px 16px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                color: var(--accent-color);
                text-decoration: none;
                border-radius: var(--radius);
                border: 1px solid var(--border-color);
                font-weight: 500;
                transition: var(--transition);
                font-size: 0.9rem;
            }

            .api-link:hover {
                background: var(--accent-color);
                color: white;
                border-color: var(--accent-color);
                transform: translateY(-1px);
            }

            /* API Instructions in Settings Panel */
            .api-instructions {
                margin-bottom: 12px;
                padding: 12px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: var(--radius);
                border: 1px solid var(--border-color);
            }

            .api-instructions-text {
                color: var(--text-secondary);
                font-size: 0.9rem;
                margin-bottom: 10px;
                line-height: 1.4;
            }

            .api-instructions-links {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
            }

            .api-instruction-link {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                padding: 6px 12px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                color: var(--text-primary);
                text-decoration: none;
                border-radius: var(--radius);
                border: 1px solid var(--border-color);
                font-size: 0.85rem;
                font-weight: 500;
                transition: var(--transition);
            }

            .api-instruction-link:hover {
                background: var(--accent-color);
                color: white;
                border-color: var(--accent-color);
                transform: translateY(-1px);
            }

            .welcome-api-input {
                text-align: left;
                max-width: 300px;
                margin: 0 auto;
            }

            .welcome-api-input label {
                display: block;
                color: var(--text-primary);
                margin-bottom: 8px;
                font-weight: 500;
            }

            .welcome-input {
                width: 100%;
                padding: 12px 16px;
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border: 1px solid var(--border-color);
                border-radius: var(--radius);
                color: var(--text-primary);
                font-size: 1rem;
                transition: var(--transition);
            }

            .welcome-input:focus {
                outline: none;
                border-color: var(--accent-color);
                box-shadow: 0 0 0 3px rgba(6, 163, 215, 0.1);
            }

            .welcome-consent {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-top: 12px;
                margin-bottom: 20px;
                justify-content: center;
            }
            
            .welcome-consent .checkbox-input {
                flex-shrink: 0;
                margin: 0;
            }
            
            .welcome-consent .checkbox-label {
                margin: 0;
                align-self: center;
            }

            .welcome-start-btn {
                background: var(--accent-color);
                color: white;
                border: 1px solid var(--accent-color);
                padding: 14px 29px;
                border-radius: 6px;
                font-size: 1.08rem;
                font-weight: 500;
                cursor: pointer;
                transition: var(--transition);
                margin-bottom: 15px;
                min-width: 216px;
                height: 53px;
                display: flex;
                align-items: center;
                justify-content: center;
                text-transform: none;
                letter-spacing: normal;
            }

            .welcome-start-btn:hover {
                background: var(--accent-hover);
                border-color: var(--accent-hover);
                transform: translateY(-1px);
            }

            .welcome-mode-selector {
                margin: 20px 0;
                text-align: center;
            }

            .welcome-mode-selector h3 {
                color: var(--text-primary);
                font-size: 1.2rem;
                margin-bottom: 15px;
            }

            .mode-options {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-bottom: 20px;
            }

            .mode-option {
                background: rgb(182 182 204 / 5%);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: center;
                min-width: 150px;
            }

            .mode-option:hover {
                background: rgb(182 182 204 / 8%);
                border-color: rgba(6, 163, 215, 0.3);
            }

            .mode-option.active {
                background: rgba(6, 163, 215, 0.08);
                border-color: rgba(6, 163, 215, 0.4);
            }

            .mode-icon {
                font-size: 2rem;
                margin-bottom: 10px;
            }

            .mode-option h4 {
                color: var(--text-primary);
                font-size: 1rem;
                margin-bottom: 8px;
            }

            .mode-option p {
                color: var(--text-secondary);
                font-size: 0.85rem;
                line-height: 1.4;
            }

            .welcome-advanced-btn {
                background: var(--accent-color);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 6px;
                font-size: 0.9rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                text-transform: none;
                letter-spacing: normal;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .welcome-advanced-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(6, 163, 215, 0.3);
            }

            .welcome-advanced-btn.secondary {
                background: transparent;
                border: 1px solid var(--border-color);
                color: var(--text-secondary);
                font-size: 1.08rem;
                font-weight: 500;
                text-transform: none;
                letter-spacing: normal;
                height: 53px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 6px;
                padding: 14px 29px;
                min-width: 216px;
            }

            .welcome-advanced-btn.secondary:hover {
                background: rgb(182 182 204 / 8%);
                color: var(--text-primary);
            }

            .welcome-actions {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
                margin-top: 20px;
            }

            .welcome-advanced-btn {
                background: linear-gradient(135deg, #8b5cf6, #06a3d7);
            }

            .welcome-advanced-btn-compact {
                background: rgb(182 182 204 / 7%);
                backdrop-filter: blur(60px);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
                padding: 14px 29px;
                border-radius: 6px;
                font-size: 1.08rem;
                font-weight: 500;
                cursor: pointer;
                transition: var(--transition);
                text-transform: none;
                letter-spacing: normal;
                width: auto;
                margin-bottom: 15px;
            }

            .welcome-advanced-btn-compact:hover {
                background: rgba(60, 60, 70, 0.9);
                border-color: var(--accent-color);
                transform: translateY(-1px);
            }

            /* Advanced Setup Overlay */
            .advanced-setup-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(40px);
                -webkit-backdrop-filter: blur(40px);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: fadeIn 0.5s ease-out;
            }

            .advanced-setup-content {
                background: var(--bg-primary);
                border-radius: 16px;
                padding: 30px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                border: 1px solid var(--border-color);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                scrollbar-width: thin;
                scrollbar-color: var(--accent-color) transparent;
                user-select: text;
                -webkit-user-select: text;
                -moz-user-select: text;
                -ms-user-select: text;
            }

            .advanced-setup-content::-webkit-scrollbar {
                width: 6px;
            }

            .advanced-setup-content::-webkit-scrollbar-track {
                background: transparent;
            }

            .advanced-setup-content::-webkit-scrollbar-thumb {
                background: var(--accent-color);
                border-radius: 3px;
            }

            .advanced-setup-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
                padding-bottom: 15px;
                border-bottom: 1px solid var(--border-color);
            }

            .advanced-setup-header h2 {
                color: var(--text-primary);
                font-size: 1.5rem;
                margin: 0;
            }

            .close-btn {
                background: none;
                border: none;
                color: var(--text-secondary);
                font-size: 1.5rem;
                cursor: pointer;
                padding: 5px;
                border-radius: 4px;
                transition: all 0.2s ease;
            }

            .close-btn:hover {
                background: rgb(182 182 204 / 8%);
                color: var(--text-primary);
            }

            .setup-steps {
                margin-bottom: 25px;
            }

            .step {
                display: flex;
                gap: 15px;
                margin-bottom: 25px;
                padding: 20px;
                background: rgb(182 182 204 / 3%);
                border-radius: 12px;
                border: 1px solid var(--border-color);
            }

            .step-number {
                background: var(--accent-color);
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 0.9rem;
                flex-shrink: 0;
            }

            .step-content h3 {
                color: var(--text-primary);
                font-size: 1.1rem;
                margin-bottom: 10px;
            }

            .code-block {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                padding: 12px;
                margin: 8px 0;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
            }

            .code-block code {
                color: var(--accent-color);
                font-family: 'Courier New', monospace;
                font-size: 0.85rem;
                font-weight: bold;
                flex: 1;
                word-break: break-all;
            }

            .copy-btn {
                background: rgba(6, 163, 215, 0.2);
                border: 1px solid rgba(6, 163, 215, 0.3);
                color: #06a3d7;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.75rem;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .copy-btn:hover {
                background: rgba(6, 163, 215, 0.3);
                border-color: rgba(6, 163, 215, 0.5);
            }

            .step-content ol {
                color: var(--text-secondary);
                padding-left: 20px;
                margin: 10px 0;
            }

            .step-content ol li {
                margin-bottom: 8px;
                line-height: 1.4;
            }

            .step-content ol code {
                background: rgba(0, 0, 0, 0.3);
                padding: 2px 6px;
                border-radius: 4px;
                color: var(--accent-color);
                font-family: 'Courier New', monospace;
                font-size: 0.8rem;
                font-weight: bold;
            }

            .bot-config {
                margin-top: 15px;
            }

            .shortcuts-overview {
                margin: 25px 0;
                padding: 20px;
                background: rgb(182 182 204 / 3%);
                border-radius: 12px;
                border: 1px solid var(--border-color);
            }

            .shortcuts-overview h3 {
                color: var(--text-primary);
                font-size: 1.1rem;
                margin-bottom: 15px;
                text-align: center;
            }

            .shortcuts-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }

            .shortcut-item {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 8px 12px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 6px;
                border: 1px solid var(--border-color);
            }

            .shortcut-item kbd {
                background: var(--accent-color);
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-family: 'Courier New', monospace;
                font-size: 0.8rem;
                font-weight: bold;
                min-width: 24px;
                text-align: center;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }

            .shortcut-item span {
                color: var(--text-secondary);
                font-size: 0.85rem;
            }

            /* Inline links in advanced setup */
            .advanced-setup-content a {
                color: var(--accent-color);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .advanced-setup-content a:hover {
                color: var(--accent-hover);
                text-decoration: underline;
            }

            .advanced-setup-actions {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 25px;
                padding-top: 20px;
                border-top: 1px solid var(--border-color);
            }

            .welcome-note {
                color: var(--text-secondary);
                font-size: 0.9rem;
                font-style: italic;
                margin: 20px;
            }

            .welcome-teaser-section {
                margin: 20px 0;
                text-align: center;
            }

            .video-container {
                position: relative;
                display: inline-block;
                width: 100%;
            }

            .welcome-teaser-video {
                width: 100%;
                height: auto;
                border-radius: var(--radius);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            }

            .video-maximize-btn {
                position: absolute;
                bottom: 12px;
                right: 12px;
                background: rgba(0, 0, 0, 0.7);
                border: none;
                border-radius: 8px;
                color: white;
                cursor: pointer;
                padding: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
                z-index: 10;
            }

            .video-maximize-btn:hover {
                background: rgba(0, 0, 0, 0.9);
                transform: scale(1.05);
            }

            .video-maximize-btn:active {
                transform: scale(0.95);
            }

            .video-maximize-btn svg {
                width: 20px;
                height: 20px;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            /* Mobile responsiveness for welcome overlay */
            @media (max-width: 768px) {
                .welcome-content {
                    padding: 20px;
                    margin: 10px;
                }

                .welcome-header h1 {
                    font-size: 1.8rem;
                }

                .welcome-subtitle {
                    font-size: 0.9rem;
                    margin-bottom: 20px;
                }

                .feature-grid {
                    grid-template-columns: 1fr;
                    gap: 16px;
                    margin-bottom: 20px;
                }

                .feature-item {
                    padding: 16px;
                }

                .features-title {
                    font-size: 1.3rem;
                }

                .feature-icon {
                    font-size: 1.8rem;
                }

                .feature-item h3 {
                    font-size: 1rem;
                }

                .feature-description {
                    font-size: 0.85rem;
                }

                .welcome-api-section {
                    padding: 15px;
                    margin: 15px 0;
                }

                .api-links {
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                }

                .welcome-teaser-section {
                    margin: 15px 0;
                }

                .welcome-teaser-video {
                    max-width: 100%;
                }

                .api-link {
                    width: 100%;
                    max-width: 250px;
                    justify-content: center;
                }
                
                /* Hide screenshot and record buttons on mobile */
                .control-item:has(button[onclick*="captureScreenshot"]),
                .control-item:has(button[onclick*="toggleVideoRecording"]) {
                    display: none;
                }
                
                /* Hide camera button in fluid background section on mobile */
                #fluidCameraButton {
                    display: none;
                }
                
                /* Hide keyboard shortcuts on mobile */
                .keyboard-shortcuts-info {
                    display: none;
                }
                
                /* Show tablet shortcuts on mobile */
                .tablet-shortcuts-info {
                    display: block;
                }
                
                /* QR Code mobile responsiveness - square with padding and rounded corners */
                .qr-code-container {
                    padding: 0;
                    margin: 8px 0;
                    background: transparent;
                    border-radius: 0;
                    border: none;
                    box-shadow: none;
                }
                
                #telegramQRCanvas {
                    max-width: 120px !important;
                    width: 120px !important;
                    height: auto !important;
                    margin: 0 auto !important;
                    padding: 8px;
                    border-radius: 8px;
                    background: white;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                    border: 1px solid rgba(255, 255, 255, 0.9);
                }
            }

            .welcome-attribution {
                text-align: center;
                margin-top: 20px;
                padding-top: 15px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.7);
                font-size: 0.85rem;
            }

            .welcome-attribution a {
                color: var(--accent-color);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .welcome-attribution a:hover {
                color: #22c55e;
                text-decoration: underline;
            }

            .welcome-attribution .heart {
                color: #ef4444;
                font-size: 1rem;
                margin: 0 2px;
            }

            .settings-attribution {
                text-align: center;
                margin-top: 15px;
                padding-top: 10px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.6);
                font-size: 0.8rem;
            }

            .settings-attribution a {
                color: var(--accent-color);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .settings-attribution a:hover {
                color: #22c55e;
                text-decoration: underline;
            }

            .settings-attribution .heart {
                color: #ef4444;
                font-size: 0.9rem;
                margin: 0 2px;
            }

            /* Tablet Responsive */
            @media (min-width: 769px) and (max-width: 1024px) {
                .panel-content {
                    padding: 20px 50px 50px 50px;
                }
                
                /* Hide camera button in fluid background section on tablet */
                #fluidCameraButton {
                    display: none;
                }
            }
            
            /* Hide cursor when toggle is active */
            body.hide-cursor,
            body.hide-cursor * {
                cursor: none !important;
            }
            
            /* Cursor indicator when cursor is hidden */
            .cursor-indicator {
                position: fixed;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background-color: rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(10px);
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.1), 0 0 40px rgba(0, 0, 0, 0.1);
                pointer-events: none;
                z-index: 9999;
                transform: translate(-50%, -50%);
                display: none;
            }
            
            body.hide-cursor .cursor-indicator {
                display: block;
            }
        </style>
        <script>
            window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
            ga('create', 'UA-105392568-1', 'auto');
            ga('send', 'pageview');
        </script>
        <script async src="https://www.google-analytics.com/analytics.js"></script>
    </head>
    <body>
        <!-- Welcome Overlay -->
        <div id="welcomeOverlay" class="welcome-overlay" style="display: none;">
            <div class="welcome-content">
                <div class="welcome-header">
                    <h1> Diffusion Lab</h1>
                    <p class="welcome-subtitle">Watch your creations come alive as AI transforms fluid simulations, camera stream, videos or audio into mesmerizing generative art in real-time</p>
                </div>
                
                <div class="welcome-teaser-section">
                    <div class="video-container">
                        <video class="welcome-teaser-video" autoplay muted loop playsinline>
                            <source src="diffusion_lab_teaser.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <button class="video-maximize-btn" onclick="maximizeVideo()" title="Maximize video">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="welcome-features">
                    <h2 class="features-title">Core Features</h2>
                    <div class="feature-grid">
                        <div class="feature-item primary">
                            <div class="feature-icon"><i class="fas fa-robot"></i></div>
                            <h3>Live AI Generation</h3>
                            <p class="feature-description">The world's first hosted StreamDiffusion platform. Ultra-low latency, subsecond response times, and GPU-free workflows. Multi-ControlNet, IPAdapter, and TensorRT acceleration built-in with 99% uptime reliability.</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-paper-plane"></i></div>
                            <h3>Remote Control</h3>
                            <p class="feature-description">Control your entire setup from anywhere. Multiple people can send prompts and commands via Telegram bot to create, modify, and manage your art collaboratively in real-time.</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-tablet-alt"></i></div>
                            <h3>Touch Perfection</h3>
                            <p class="feature-description">Designed for touch. Intuitive gestures, fluid interactions, and perfect responsiveness on any device.</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-broadcast-tower"></i></div>
                            <h3>Professional Control</h3>
                            <p class="feature-description">Studio-grade precision control. Integrate with TouchOSC seamlessly for real-time performance.</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-image"></i></div>
                            <h3>Brand Integration</h3>
                            <p class="feature-description">Add your own brand elements and key visuals to create personalized fluid backgrounds. Bring your logos, graphics, and brand assets to life with dynamic fluid effects.</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-camera"></i></div>
                            <h3>Webcam Interaction</h3>
                            <p class="feature-description">Turn your webcam into an interactive canvas. See yourself become part of the art in real-time.</p>
                        </div>
                    </div>
                </div>
                
                <div class="welcome-mode-selector">
                    <h3>Choose Your Setup</h3>
                    <div class="mode-options">
                        <div class="mode-option active" id="simpleMode">
                            <div class="mode-icon"></div>
                            <h4>Simple Mode</h4>
                            <p>Just add your API key and start creating immediately</p>
                        </div>
                        <div class="mode-option" id="advancedMode">
                            <div class="mode-icon"></div>
                            <h4>Advanced Setup</h4>
                            <p>Full setup with Telegram bot and OSC integration</p>
                        </div>
                    </div>
                </div>

                <div class="welcome-api-section" id="simpleApiSection">
                    <h3> Your API Key</h3>
                    
                    <div class="welcome-api-input">
                        <input type="password" id="welcomeApiKey" class="welcome-input" placeholder="sk_..." />
                        <div class="welcome-consent">
                            <input type="checkbox" id="welcomeApiConsent" class="checkbox-input">
                            <label for="welcomeApiConsent" class="checkbox-label">Remember API key (stored locally)</label>
                        </div>
                    </div>
                    
                    <div class="api-links">
                        <a href="https://discord.com/channels/1368975848123666553/1399823418240663592/1410359887950516224" target="_blank" class="api-link">
                             Get Passcode from Discord
                        </a>
                        <a href="https://app.daydream.live/StreamDiffusionTD/api-key" target="_blank" class="api-link">
                             Get API Key
                        </a>
                    </div>
                </div>
                
                <div class="welcome-actions">
                    <p class="welcome-note">You can also start without an API key and add it later in settings</p>
                    <button id="welcomeStartButton" class="welcome-start-btn">
                        Start Creating
                    </button>
                    <button id="advancedSetupButton" class="welcome-advanced-btn-compact" onclick="showAdvancedSetup()">
                        Advanced Setup
                    </button>
                </div>
                
                <div class="welcome-attribution">
                    Made with <span class="heart"></span> by <a href="https://www.linkedin.com/in/simonfrubis/" target="_blank">Simon Frbis</a> using <a href="https://daydream.live/" target="_blank">Daydream.live</a><br>
                    <a href="https://github.com/smon1127/Diffusion-Lab" target="_blank"><i class="fab fa-github"></i> View on GitHub</a>
                </div>
            </div>
        </div>

        <!-- Advanced Setup Overlay -->
        <div id="advancedSetupOverlay" class="advanced-setup-overlay" style="display: none;">
            <div class="advanced-setup-content">
                <div class="advanced-setup-header">
                    <h2> Advanced Setup</h2>
                    <button class="close-btn" onclick="hideAdvancedSetup()"></button>
                </div>
                
                <div class="setup-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Download & Install</h3>
                            <div class="code-block">
                                <code>git clone https://github.com/smon1127/Diffusion-Lab.git</code>
                                <button class="copy-btn" onclick="copyToClipboard('git clone https://github.com/smon1127/Diffusion-Lab.git')">Copy</button>
                            </div>
                            <div class="code-block">
                                <code>cd Diffusion-Lab && npm install</code>
                                <button class="copy-btn" onclick="copyToClipboard('cd Diffusion-Lab && npm install')">Copy</button>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Setup Script Permissions</h3>
                            <div class="code-block">
                                <code>chmod +x start-diffusion-lab.sh</code>
                                <button class="copy-btn" onclick="copyToClipboard('chmod +x start-diffusion-lab.sh')">Copy</button>
                            </div>
                            <div class="code-block">
                                <code>./start-diffusion-lab.sh</code>
                                <button class="copy-btn" onclick="copyToClipboard('./start-diffusion-lab.sh')">Copy</button>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Create Telegram Bot</h3>
                            <ol>
                                <li>Open <a href="https://t.me/BotFather" target="_blank">@BotFather</a> on Telegram</li>
                                <li>Send <code>/newbot</code> command</li>
                                <li>Choose a name for your bot</li>
                                <li>Choose a username (must end with 'bot')</li>
                                <li>Copy the bot token provided</li>
                            </ol>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Configure Your Bot</h3>
                            <div class="bot-config">
                                <input type="text" id="advancedTelegramToken" class="welcome-input" placeholder="Paste your bot token here..." />
                                <div class="welcome-consent">
                                    <input type="checkbox" id="advancedTelegramConsent" class="checkbox-input" checked>
                                    <label for="advancedTelegramConsent" class="checkbox-label">Remember token</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3>Setup TouchOSC</h3>
                            <ol>
                                <li>Download <a href="https://hexler.net/touchosc" target="_blank">TouchOSC</a> on your device</li>
                                <li>Find your Mac's IP address: Hold <code>Option</code> and click the WiFi icon in the menu bar</li>
                                <li>Open TouchOSC and tap the <strong>WiFi symbol</strong> in the top right</li>
                                <li>Go to <strong>OSC</strong>  <strong>Add IP</strong> and enter your Mac's IP address</li>
                                <li>Set <strong>Send Port</strong> to <code>8000</code></li>
                                <li>Open the <code>MultiXY</code> sample from the TouchOSC library</li>
                                <li>Use the XY pads to spawn fluid splats in real-time</li>
                            </ol>
                            <div class="code-block">
                                <code>Default OSC Port: 8000</code>
                                <button class="copy-btn" onclick="copyToClipboard('8000')">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="shortcuts-overview">
                    <h3> Keyboard Shortcuts</h3>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>P</kbd>
                            <span>Pause/Resume simulation</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>B</kbd>
                            <span>Add random splat burst</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>C</kbd>
                            <span>Toggle colorful mode</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>D</kbd>
                            <span>Toggle debug mode</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>R</kbd>
                            <span>Toggle video recording</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>X</kbd>
                            <span>Reset all values</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>A</kbd>
                            <span>Toggle animation</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>V</kbd>
                            <span>Toggle velocity drawing</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>H</kbd>
                            <span>Hide cursor & panel</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>O</kbd>
                            <span>Toggle panel</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>Space</kbd>
                            <span>Capture screenshot</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>1-6</kbd>
                            <span>Load prompt presets</span>
                        </div>
                    </div>
                </div>

                <div class="advanced-setup-actions">
                    <button class="welcome-start-btn" onclick="saveAdvancedSetup()">
                        Complete Setup
                    </button>
                    <button class="welcome-advanced-btn secondary" onclick="hideAdvancedSetup()">
                        Back to Simple Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- Debug Overlay (OSC & Mobile) -->
        <div id="mobileDebug" style="display: none !important; position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.9); color: white; padding: 12px; font-size: 12px; border-radius: 8px; z-index: 9999; max-width: 300px; font-family: monospace; border: 1px solid rgba(255,255,255,0.2);">
            <div style="color: #06a3d7; font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid rgba(6,163,215,0.3); padding-bottom: 4px;">
                <i class="fas fa-bug"></i> Debug Info
            </div>
            <div id="debugInfo"></div>
            <div id="oscInfo" style="margin-top: 12px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 8px;">
                <div style="color: #22c55e; font-weight: bold; margin-bottom: 6px;">
                    <i class="fas fa-broadcast-tower"></i> OSC Messages:
                </div>
                <div id="oscMessages" style="max-height: 120px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 6px; border-radius: 4px; border-left: 3px solid #22c55e; scrollbar-width: none; -ms-overflow-style: none;"></div>
            </div>
            <div id="telegramInfo" style="margin-top: 12px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 8px;">
                <div style="color: #f472b6; font-weight: bold; margin-bottom: 6px;">
                    <i class="fas fa-paper-plane"></i> Telegram Messages:
                </div>
                <div id="telegramMessages" style="max-height: 120px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 6px; border-radius: 4px; border-left: 3px solid #f472b6; scrollbar-width: none; -ms-overflow-style: none;"></div>
            </div>
            <div id="daydreamInfo" style="margin-top: 12px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 8px;">
                <div style="color: #8b5cf6; font-weight: bold; margin-bottom: 6px;">
                    <i class="fas fa-cloud"></i> Daydream Stream:
                </div>
                <div id="daydreamMessages" style="max-height: 120px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 6px; border-radius: 4px; border-left: 3px solid #8b5cf6; scrollbar-width: none; -ms-overflow-style: none;"></div>
            </div>
        </div>

        <canvas id="fluidCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;"></canvas>
        <canvas id="audioBlobCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; display: none;"></canvas>
        <canvas id="cameraCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; display: none;"></canvas>
        <canvas id="mediaCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; display: none;"></canvas>
        
        <!-- Cursor indicator for when cursor is hidden -->
        <div id="cursorIndicator" class="cursor-indicator"></div>
        
        <!-- Hidden file input for media selection -->
        <input type="file" id="mediaFileInput" accept="image/*,video/*" style="display: none;" />

        <!-- Stream Overlay -->
        <div id="streamOverlay" class="stream-overlay">
            <div class="stream-overlay-content">
                <div class="stream-overlay-loading" id="streamOverlayLoading">Loading stream...</div>
                <iframe id="streamOverlayFrame" src="" style="display: none;"></iframe>
            </div>
        </div>

        <!-- Modern Control Panel -->
        <div class="control-panel" id="controlPanel">
            <div class="panel-header" onclick="safeTogglePanel()" ontouchstart="safeTogglePanel(); event.preventDefault();">
                <span>AI Controls</span>
                <span class="toggle-icon"></span>
            </div>
            
            <div class="panel-content" id="panelContent">
                <!-- StreamDiffusion Quick Controls - Always Visible -->
                <div class="control-group">
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Stream Status</span>
                            <span class="stream-status" id="streamStatus" style="display: none;"></span>
                        </div>
                        <button class="modern-button" id="streamButton" onclick="safeToggleStream()" ontouchstart="safeToggleStream()">
                            Start Stream
                        </button>
                        <div class="stream-controls-row" id="streamControlsRow" style="display: none;">
                            <div class="tooltip" style="flex: 1; min-width: 0; position: relative;">
                                <button class="stream-control-button primary" id="copyStreamUrlButton" 
                                        onclick="copyStreamUrlToClipboard()" 
                                        ontouchstart="copyStreamUrlToClipboard(); event.preventDefault();"
                                        oncontextmenu="event.preventDefault(); copyStreamUrlToClipboard(true);">
                                    <i class="fas fa-copy"></i>
                                    <span>Copy URL</span>
                                    <span class="tooltiptext">Copy Stream URL</span>
                                </button>
                            </div>
                            <div class="tooltip">
                                <button class="stream-control-button" id="fullscreenToggleButton" 
                                        onclick="toggleFullscreen()" 
                                        ontouchstart="toggleFullscreen(); event.preventDefault();">
                                    <i class="fas fa-expand" id="fullscreenIcon"></i>
                                </button>
                                <span class="tooltiptext" id="fullscreenTooltip">Enter Fullscreen</span>
                            </div>
                            <div class="tooltip">
                                <button class="stream-control-button" id="popOutStreamButtonUI" 
                                        onclick="popOutStream()" 
                                        ontouchstart="popOutStream(); event.preventDefault();">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <span class="tooltiptext">Pop-Out Stream</span>
                            </div>
                            <div class="tooltip">
                                <button class="stream-control-button" id="hideStreamToggle" 
                                        onclick="toggleStreamVisibility()" 
                                        ontouchstart="toggleStreamVisibility(); event.preventDefault();">
                                    <i class="fas fa-eye" id="hideStreamIcon"></i>
                                </button>
                                <span class="tooltiptext" id="hideStreamTooltip">Hide Stream</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item" id="streamOpacityContainer" style="display: none;">
                        <div class="control-label">
                            <span>Stream Opacity</span>
                            <input type="text" class="control-value number-input" id="streamOpacityValue" value="0.8" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'streamOpacity', 0, 1)" ontouchstart="handleSliderClick(event, 'streamOpacity', 0, 1); event.preventDefault();">
                            <div class="slider-fill" id="streamOpacityFill" style="width: 80%">
                                <div class="slider-handle" id="streamOpacityHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Prompt</span>
                        </div>
                        <div class="textarea-container">
                            <textarea class="text-input auto-resize-textarea" id="promptInput" placeholder="blooming flower with delicate petals..." title="Describe what you want the AI to generate" rows="1"></textarea>
                            <button class="paste-button" id="pastePromptButton" onclick="pasteFromClipboard('promptInput')" title="Paste from clipboard">
                                <i class="fas fa-clipboard"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Prompt Presets Section -->
                    <div class="advanced-section">
                        <div class="control-label">
                            <span>Prompt Presets</span>
                        </div>
                        <div class="prompt-preset-grid">
                            <button class="preset-btn active" onclick="setPrompt('blooming flower with delicate petals, vibrant colors, soft natural lighting, botanical beauty, detailed macro photography, spring garden atmosphere')" ontouchstart="setPrompt('blooming flower with delicate petals, vibrant colors, soft natural lighting, botanical beauty, detailed macro photography, spring garden atmosphere'); event.preventDefault();">Blooming flower</button>
                            <button class="preset-btn" onclick="setPrompt('giant glowing jellyfish, slow graceful movement, neon blue and pink bioluminescence, flowing tendrils like silk, underwater ballet, dreamlike ocean atmosphere')" ontouchstart="setPrompt('giant glowing jellyfish, slow graceful movement, neon blue and pink bioluminescence, flowing tendrils like silk, underwater ballet, dreamlike ocean atmosphere'); event.preventDefault();">Jellyfish Ballet</button>
                            <button class="preset-btn" onclick="setPrompt('evolving fractal jellyfish, recursive growth, rainbow light trails, kaleidoscopic motion')" ontouchstart="setPrompt('evolving fractal jellyfish, recursive growth, rainbow light trails, kaleidoscopic motion'); event.preventDefault();">Fractal Jellyfish</button>
                            <button class="preset-btn" onclick="setPrompt('northern lights over snow-capped mountains, aurora borealis, starry night sky, ethereal green and purple lights, pristine wilderness')" ontouchstart="setPrompt('northern lights over snow-capped mountains, aurora borealis, starry night sky, ethereal green and purple lights, pristine wilderness'); event.preventDefault();">Aurora Mountains</button>
                            <button class="preset-btn" onclick="setPrompt('floating islands with waterfalls, magical gardens, ethereal mist, fantasy landscape, soft pastel colors, Studio Ghibli style')" ontouchstart="setPrompt('floating islands with waterfalls, magical gardens, ethereal mist, fantasy landscape, soft pastel colors, Studio Ghibli style'); event.preventDefault();">Floating Islands</button>
                            <button class="preset-btn" onclick="setPrompt('bioluminescent mushrooms, glowing forest at night, magical blue and green lights, fairy tale atmosphere, mystical fog')" ontouchstart="setPrompt('bioluminescent mushrooms, glowing forest at night, magical blue and green lights, fairy tale atmosphere, mystical fog'); event.preventDefault();">Magic Forest</button>
                        </div>
                    </div>
                    
                    <!-- Negative Prompt Section -->
                    <div class="advanced-section">
                        <div class="advanced-toggle" onclick="safeToggleNegativePrompt()" ontouchstart="safeToggleNegativePrompt(); event.preventDefault();">
                            <div class="toggle-icon" id="negativePromptIcon"></div>
                            <span>Negative Prompt</span>
                        </div>
                        <div class="advanced-content" id="negativePromptContent">
                            <div class="control-item">
                                <input type="text" class="text-input" id="negativePromptInput" placeholder="blurry, low quality" title="Describe what you don't want the AI to generate" />
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Input Section -->
                <div class="control-group">
                    <div class="group-title">Select Input</div>
                    
                    <div class="control-item">
                        <button class="modern-button secondary" id="fluidDrawingButton" onclick="safeToggleFluidDrawing()" ontouchstart="safeToggleFluidDrawing()">
                            <i class="fas fa-paint-brush"></i> Fluid Drawing
                        </button>
                    </div>
                    
                    <div class="control-item">
                        <button class="modern-button secondary" id="audioBlobButton" onclick="safeToggleAudioBlob()" ontouchstart="safeToggleAudioBlob()">
                            <i class="fas fa-music"></i> Audio
                        </button>
                    </div>
                    
                    <div class="control-item">
                        <button class="modern-button secondary" id="cameraButton" onclick="toggleCamera()" ontouchstart="toggleCamera(); event.preventDefault();">
                            <i class="fas fa-video"></i> Camera
                        </button>
                    </div>
                    
                    <div class="control-item">
                        <button class="modern-button secondary" id="mediaButton" onclick="toggleMedia()" ontouchstart="toggleMedia(); event.preventDefault();">
                            <i class="fas fa-video"></i> Media
                        </button>
                    </div>
                    
                    <div class="audio-controls" id="audioControls" style="display: none; margin-top: 12px;">
                                                    <div class="control-item">
                                <div class="group-title">
                                    Audio Input
                                </div>
                                <select id="audioInputSelect" class="audio-select" style="width: 100%; padding: 8px 12px; background: var(--control-bg); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 13px;">
                                    <option value="">Default Microphone</option>
                                </select>
                            </div>

                            <div class="control-item">
                                <button class="modern-button secondary" id="previewAudioButton" onclick="toggleAudioPreview()" ontouchstart="toggleAudioPreview(); event.preventDefault();" style="display: none;">
                                    <i class="fas fa-volume-up"></i> Preview Audio
                                </button>
                            </div>
                            
                            <div class="control-item">
                            <div class="control-label">
                                <span>Reactivity <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Audio sensitivity: higher values make blob more responsive to quiet sounds</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="audioReactivityValue" value="1.0" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'audioReactivity', 0.1, 3.0)" ontouchstart="handleSliderClick(event, 'audioReactivity', 0.1, 3.0); event.preventDefault();">
                                <div class="slider-fill" id="audioReactivityFill" style="width: 30%">
                                    <div class="slider-handle" id="audioReactivityHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Delay <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Audio processing delay in milliseconds (0-500ms)</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="audioDelayValue" value="0" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'audioDelay', 0, 500)" ontouchstart="handleSliderClick(event, 'audioDelay', 0, 500); event.preventDefault();">
                                <div class="slider-fill" id="audioDelayFill" style="width: 0%">
                                    <div class="slider-handle" id="audioDelayHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Opacity <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Audio blob transparency (0.0 = invisible, 1.0 = opaque)</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="audioOpacityValue" value="0.8" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'audioOpacity', 0, 1)" ontouchstart="handleSliderClick(event, 'audioOpacity', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="audioOpacityFill" style="width: 80%">
                                    <div class="slider-handle" id="audioOpacityHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Colorful <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Color cycling speed: 0.0 = base color only, higher values = faster cycling through random colors</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="audioColorfulValue" value="0.3" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'audioColorful', 0, 1)" ontouchstart="handleSliderClick(event, 'audioColorful', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="audioColorfulFill" style="width: 30%">
                                    <div class="slider-handle" id="audioColorfulHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Edge Softness <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Controls how soft or sharp the blob edges appear (0 = sharp, 1 = very soft)</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="audioEdgeSoftnessValue" value="0.25" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'audioEdgeSoftness', 0, 1)" ontouchstart="handleSliderClick(event, 'audioEdgeSoftness', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="audioEdgeSoftnessFill" style="width: 25%">
                                    <div class="slider-handle" id="audioEdgeSoftnessHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Blob Color <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Base color for the audio blob</span>
                                </div></span>
                                <input type="text" id="audioBlobColorPicker" class="color-input" value="#06a3d7" data-coloris readonly inputmode="none">
                            </div>
                        </div>
                    </div>
                </div>
                
                            <!-- Media Controls Section -->
            <div class="media-controls" id="mediaControls" style="display: none; margin-top: 12px;">
                <div class="control-group">
                    <div class="group-title">MEDIA</div>
                    
                    <!-- Choose Media Button - Tablet Optimized -->
                    <div class="control-item" style="margin-bottom: 12px;">
                        <label for="mediaFileInput" id="chooseMediaButton" class="modern-button secondary tablet-optimized-button" role="button" aria-label="Choose media file to upload" tabindex="0">
                            <i class="fas fa-folder-open"></i> Choose Media
                        </label>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Scale <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Media size: 0.1 = very small, 1.0 = fit viewport, 2.0 = very large</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="mediaScaleValue" value="1.00" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'mediaScale', 0.1, 2.0)" ontouchstart="handleSliderClick(event, 'mediaScale', 0.1, 2.0); event.preventDefault();">
                            <div class="slider-fill" id="mediaScaleFill" style="width: 47%">
                                <div class="slider-handle" id="mediaScaleHandle"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                
                <!-- Fluid Controls Section -->
                <div id="fluidControlsContent">
                        <!-- Fluid and Canvas Colors -->
                        <div class="control-group">
                        <div class="group-title">FLUID AND CANVAS</div>
                        
                        <div class="color-row">
                            <div class="color-container full">
                                <span class="color-label">Brush</span>
                                <input type="text" id="staticColorPicker" class="color-input" value="#06a3d7" data-coloris readonly inputmode="none">
                            </div>
                            <div class="color-container full">
                                <span class="color-label">Background</span>
                                <input type="text" id="backgroundColorPicker" class="color-input" value="#000000" data-coloris readonly inputmode="none">
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleAnimate()" ontouchstart="toggleAnimate(); event.preventDefault();">
                            <span>Animate</span>
                            <div class="toggle-switch active" id="animateToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleHideCursor()" ontouchstart="toggleHideCursor(); event.preventDefault();">
                            <span>Hide Cursor</span>
                            <div class="toggle-switch" id="hideCursorToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleColorful()" ontouchstart="toggleColorful()">
                            <span>Colorful</span>
                            <div class="toggle-switch" id="colorfulToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="togglePaused()" ontouchstart="togglePaused()">
                            <span>Paused</span>
                            <div class="toggle-switch" id="pausedToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleVelocityDrawing()" ontouchstart="toggleVelocityDrawing()">
                            <span>Velocity Drawing <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Move cursor for velocity-based splats (no click needed)</span>
                            </div></span>
                            <div class="toggle-switch" id="velocityDrawingToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleForceClick()" ontouchstart="toggleForceClick()">
                            <span>Force Click <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Click for radial burst effects!</span>
                            </div></span>
                            <div class="toggle-switch" id="forceClickToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Background Section -->
                    <div class="control-item">
                        <div class="control-label">
                            <span>Background <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Upload media as background behind fluid effects. Images: PNG, JPG, JPEG. Videos: MP4, WebM, MOV (max 50MB, auto-loops). Or use camera feed.</span>
                            </div></span>
                        </div>
                        <div class="image-upload-container">
                            <input type="file" id="mediaUpload" accept=".png,.jpg,.jpeg,.mp4,.webm,.mov" style="display: none;">
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <label for="mediaUpload" class="modern-button secondary tablet-optimized-button" role="button" aria-label="Choose background media file to upload" tabindex="0">
                                    <i class="fas fa-folder-open"></i> Choose Media
                                </label>
                                <button class="modern-button secondary" id="clearFluidMediaButton" onclick="clearFluidBackgroundMediaOnly()" ontouchstart="clearFluidBackgroundMediaOnly(); event.preventDefault();" style="display: none;">
                                    <i class="fas fa-trash-alt"></i> Clear Media
                                </button>
                                <button class="modern-button secondary tablet-optimized-button" id="fluidCameraButton" onclick="toggleFluidBackgroundCamera()" ontouchstart="toggleFluidBackgroundCamera(); event.preventDefault();">
                                    <i class="fas fa-camera"></i> Camera
                                </button>
                            </div>

                            <div class="camera-preview" id="cameraPreview" style="display: none;">
                                <video id="cameraVideo" autoplay muted style="width: 100%; max-height: 80px; border-radius: 4px;"></video>
                            </div>

                        </div>
                        
                        <div class="control-item" id="fluidMediaScaleControl" style="display: none;">
                            <div class="control-label">
                                <span>Media Scale <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Background media size: 0.1 = very small, 1.0 = fit viewport, 2.0 = large</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="fluidMediaScaleValue" value="1.00" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'fluidMediaScale', 0.1, 2.0)" ontouchstart="handleSliderClick(event, 'fluidMediaScale', 0.1, 2.0); event.preventDefault();">
                                <div class="slider-fill" id="fluidMediaScaleFill" style="width: 47%">
                                    <div class="slider-handle" id="fluidMediaScaleHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item" id="fluidCameraScaleControl" style="display: none;">
                            <div class="control-label">
                                <span>Camera Scale <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Background camera size: 0.1 = very small, 1.0 = fit viewport, 2.0 = large</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="fluidCameraScaleValue" value="1.00" style="width: 45px; font-size: 12px; color: var(--accent-color); font-weight: 600; background: rgba(6, 163, 215, 0.1); padding: 2px 8px; border-radius: 4px; border: none; text-align: center; margin-left: 4px; outline: none;" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'fluidCameraScale', 0.1, 2.0)" ontouchstart="handleSliderClick(event, 'fluidCameraScale', 0.1, 2.0); event.preventDefault();">
                                <div class="slider-fill" id="fluidCameraScaleFill" style="width: 47%">
                                    <div class="slider-handle" id="fluidCameraScaleHandle"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                        
                                                <!-- Organic Animation Controls -->
                        <div class="group-title">ANIMATION</div>
                        

                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Interval <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Animation speed: 0 = very slow (1 per 3 seconds), 1 = fast (2.8 per second)</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="animationIntervalValue" value="0.03" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'animationInterval', 0, 1)" ontouchstart="handleSliderClick(event, 'animationInterval', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="animationIntervalFill" style="width: 3%">
                                    <div class="slider-handle" id="animationIntervalHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Chaos <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Order vs chaos: 0 = coherent streams, 1 = random turbulence</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="chaosValue" value="0.73" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'chaos', 0, 1)" ontouchstart="handleSliderClick(event, 'chaos', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="chaosFill" style="width: 73%">
                                    <div class="slider-handle" id="chaosHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Breathing <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Rhythm intensity: 0 = steady, 1 = dramatic pulsing and timing</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="breathingValue" value="0.50" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'breathing', 0, 1)" ontouchstart="handleSliderClick(event, 'breathing', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="breathingFill" style="width: 50%">
                                    <div class="slider-handle" id="breathingHandle"></div>
                                </div>
                    </div>
                </div>
                
                        <div class="control-item">
                            <div class="control-label">
                                <span>Color Life <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Color evolution: 0 = static color, 1 = full rainbow cycling</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="colorLifeValue" value="0.22" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'colorLife', 0, 1)" ontouchstart="handleSliderClick(event, 'colorLife', 0, 1); event.preventDefault();">
                                <div class="slider-fill" id="colorLifeFill" style="width: 22%">
                                    <div class="slider-handle" id="colorLifeHandle"></div>
                                </div>
                    </div>
                    </div>
                    
                    
                        <!-- Physics Controls -->
                        <div class="group-title">FLUID</div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Fade <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">How fast colors fade away. Higher = faster fade</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="densityValue" value="0.50" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'density', 0, 4)" ontouchstart="handleSliderClick(event, 'density', 0, 4)">
                            <div class="slider-fill" id="densityFill" style="width: 12.5%">
                                <div class="slider-handle" id="densityHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Viscosity <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Fluid thickness. Higher = thicker, slower fluid</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="velocityValue" value="0.20" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'velocity', 0, 4)" ontouchstart="handleSliderClick(event, 'velocity', 0, 4)">
                            <div class="slider-fill" id="velocityFill" style="width: 5%">
                                <div class="slider-handle" id="velocityHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Force <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Interaction strength. Higher = more powerful strokes</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="pressureValue" value="0.80" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'pressure', 0, 1)" ontouchstart="handleSliderClick(event, 'pressure', 0, 1)">
                            <div class="slider-fill" id="pressureFill" style="width: 80%">
                                <div class="slider-handle" id="pressureHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Swirl <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Turbulence intensity. Higher = more chaotic swirls</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="vorticityValue" value="30" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'vorticity', 0, 50)" ontouchstart="handleSliderClick(event, 'vorticity', 0, 50)">
                            <div class="slider-fill" id="vorticityFill" style="width: 60%">
                                <div class="slider-handle" id="vorticityHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Brush Size <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Size of fluid interactions. Larger = bigger strokes</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="splatValue" value="0.25" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'splat', 0.01, 1)" ontouchstart="handleSliderClick(event, 'splat', 0.01, 1)">
                            <div class="slider-fill" id="splatFill" style="width: 24%">
                                <div class="slider-handle" id="splatHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Glow <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Bloom effect intensity. Higher = more glowing</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="bloomIntensityValue" value="0.40" />
                            </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'bloomIntensity', 0.1, 2)" ontouchstart="handleSliderClick(event, 'bloomIntensity', 0.1, 2)">
                            <div class="slider-fill" id="bloomIntensityFill" style="width: 16%">
                                <div class="slider-handle" id="bloomIntensityHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Rays <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Sunray effect intensity. Higher = more dramatic rays</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="sunrayValue" value="0.40" />
                            </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'sunray', 0.3, 1)" ontouchstart="handleSliderClick(event, 'sunray', 0.3, 1)">
                            <div class="slider-fill" id="sunrayFill" style="width: 14%">
                                <div class="slider-handle" id="sunrayHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleBloom()" ontouchstart="toggleBloom()">
                            <span>Bloom</span>
                            <div class="toggle-switch active" id="bloomToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="toggle-container" onclick="toggleSunrays()" ontouchstart="toggleSunrays()">
                            <span>Sunrays</span>
                            <div class="toggle-switch active" id="sunraysToggle">
                                <div class="toggle-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                </div>

                
                <!-- ControlNet Section -->
                <div class="control-group">
                    <div class="group-title">ControlNet</div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Pose <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Human pose detection strength</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="controlnetPoseValue" value="0.65" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'controlnetPose', 0, 1)" ontouchstart="handleSliderClick(event, 'controlnetPose', 0, 1)">
                            <div class="slider-fill" id="controlnetPoseFill" style="width: 65%">
                                <div class="slider-handle" id="controlnetPoseHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>HED <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Soft edge detection strength</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="controlnetHedValue" value="0.60" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'controlnetHed', 0, 1)" ontouchstart="handleSliderClick(event, 'controlnetHed', 0, 1)">
                            <div class="slider-fill" id="controlnetHedFill" style="width: 60%">
                                <div class="slider-handle" id="controlnetHedHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Canny <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Sharp edge detection strength</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="controlnetCannyValue" value="0.50" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'controlnetCanny', 0, 1)" ontouchstart="handleSliderClick(event, 'controlnetCanny', 0, 1)">
                            <div class="slider-fill" id="controlnetCannyFill" style="width: 50%">
                                <div class="slider-handle" id="controlnetCannyHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Depth <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">3D depth information strength</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="controlnetDepthValue" value="0.45" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'controlnetDepth', 0, 1)" ontouchstart="handleSliderClick(event, 'controlnetDepth', 0, 1)">
                            <div class="slider-fill" id="controlnetDepthFill" style="width: 45%">
                                <div class="slider-handle" id="controlnetDepthHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                            <span>Color <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Color preservation strength</span>
                            </div></span>
                            <input type="text" class="control-value number-input" id="controlnetColorValue" value="0.55" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'controlnetColor', 0, 1)" ontouchstart="handleSliderClick(event, 'controlnetColor', 0, 1)">
                            <div class="slider-fill" id="controlnetColorFill" style="width: 55%">
                                <div class="slider-handle" id="controlnetColorHandle"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Denoise Section -->
                <div class="control-group">
                    <div class="group-title">Denoise</div>
                    
                    <div class="control-item">
                        <div class="control-label">
                                <span>X <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Denoise X strength</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="denoiseXValue" value="3" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'denoiseX', 0, 45)" ontouchstart="handleSliderClick(event, 'denoiseX', 0, 45)">
                            <div class="slider-fill" id="denoiseXFill" style="width: 7%">
                                <div class="slider-handle" id="denoiseXHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                                <span>Y <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Denoise Y strength</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="denoiseYValue" value="6" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'denoiseY', 0, 45)" ontouchstart="handleSliderClick(event, 'denoiseY', 0, 45)">
                            <div class="slider-fill" id="denoiseYFill" style="width: 13%">
                                <div class="slider-handle" id="denoiseYHandle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-label">
                                <span>Z <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Denoise Z strength</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="denoiseZValue" value="9" />
                        </div>
                        <div class="slider-container" onclick="handleSliderClick(event, 'denoiseZ', 0, 45)" ontouchstart="handleSliderClick(event, 'denoiseZ', 0, 45)">
                            <div class="slider-fill" id="denoiseZFill" style="width: 20%">
                                <div class="slider-handle" id="denoiseZHandle"></div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <!-- ControlNet Presets Section -->
                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">
                            <span>ControlNet Presets <div class="tooltip"><span class="info-icon">i</span>
                                <span class="tooltiptext">Pre-configured settings for common creative workflows</span>
                            </div></span>
                        </div>
                        <div class="controlnet-preset-buttons">
                            <button class="preset-button active" onclick="setControlNetPreset('balanced', event)">Balanced</button>
                            <button class="preset-button" onclick="setControlNetPreset('portrait', event)">Portrait</button>
                            <button class="preset-button" onclick="setControlNetPreset('composition', event)">Composition</button>
                            <button class="preset-button" onclick="setControlNetPreset('artistic', event)">Artistic</button>
                        </div>
                    </div>
                </div>
                
                <!-- Reset Values Button -->
                <div class="control-item">
                    <button class="modern-button secondary" onclick="resetValues()">
                        Reset Values
                    </button>
                </div>
                
                <!-- Reload & Clear Cache Button -->
                <div class="control-item">
                    <button class="modern-button secondary" onclick="reloadAndClearCache()">
                        Reload & Clear Cache
                    </button>
                </div>
                
                <!-- About Button -->
                <div class="control-item">
                    <button class="modern-button secondary" onclick="showWelcomeOverlay()">
                        About
                    </button>
                </div>
                
                <!-- Settings Section -->
                <div class="advanced-section">
                    <div class="advanced-toggle" onclick="toggleSettings()" ontouchstart="toggleSettings(); event.preventDefault();">
                        <div class="toggle-icon" id="settingsIcon"></div>
                        <span>Settings</span>
                    </div>
                    
                    <div class="advanced-content" id="settingsContent">
                        <!-- Debug Toggle at top -->
                        <div class="control-item">
                            <div class="toggle-container" onclick="toggleDebug()" ontouchstart="toggleDebug()">
                                <span>Debug Mode <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Show OSC messages and debug overlay</span>
                                </div></span>
                                <div class="toggle-switch" id="debugToggle">
                                    <div class="toggle-handle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Telegram Integration Toggle -->
                        <div class="control-item">
                            <div class="toggle-container" onclick="toggleTelegramReceive()" ontouchstart="toggleTelegramReceive(); event.preventDefault();">
                                <span>Receive Prompts from Telegram</span>
                                <div class="toggle-switch active" id="telegramReceiveToggle">
                                    <div class="toggle-handle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Waitlist Controls -->
                        <div id="telegramWaitlistControls" class="control-item">
                            <div class="control-label">
                                <span>Waitlist Interval <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Time between processing Telegram prompts (1-30 seconds)</span>
                                </div></span>
                                <input type="text" class="control-value number-input" id="telegramWaitlistIntervalValue" value="1.0" />
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'telegramWaitlistInterval', 1, 30)" ontouchstart="handleSliderClick(event, 'telegramWaitlistInterval', 1, 30); event.preventDefault();">
                                <div class="slider-fill" id="telegramWaitlistIntervalFill" style="width: 3.33%">
                                    <div class="slider-handle" id="telegramWaitlistIntervalHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Clear Waitlist Button -->
                        <div id="telegramClearButton" class="control-item">
                            <button class="modern-button secondary" onclick="clearTelegramWaitlist()" ontouchstart="clearTelegramWaitlist(); event.preventDefault();">
                                <i class="fas fa-trash"></i> Clear Waitlist
                            </button>
                        </div>
                        
                        <!-- Bot Token -->
                        <div class="control-item">
                            <div class="control-label">
                                <span>Bot Token</span>
                            </div>
                            <input type="password" class="api-input" id="telegramTokenInput" placeholder="Enter your Telegram bot token..." title="Enter your Telegram bot token" />
                            <div class="checkbox-container">
                                <input type="checkbox" id="telegramTokenConsent" class="checkbox-input">
                                <label for="telegramTokenConsent" class="checkbox-label">Remember token (stored locally)</label>
                            </div>
                        </div>
                        
                        <!-- QR Code Content -->
                        <div class="control-item" id="telegramQRContent" style="margin-top: 16px;">
                            <div style="text-align: center; margin-bottom: 10px;">
                                <span style="font-size: 16px; font-weight: 600; color: var(--text-primary); font-family: monospace;" id="telegramBotDisplayName">@DiffusionPromptBot</span>
                            </div>
                            <div class="qr-code-container">
                                <canvas id="telegramQRCanvas"></canvas>
                            </div>
                        </div>
                        
                        <div class="control-item" style="margin-top: 8px; text-align: center;">
                            <a href="https://t.me/DiffusionPromptBot" target="_blank" class="telegram-bot-link" id="telegramBotLink">
                                <i class="fas fa-external-link-alt" style="font-size: 10px; margin-right: 4px; opacity: 0.7;"></i>
                                Open Telegram Bot
                            </a>
                        </div>
                        
                        <!-- API Key -->
                        <div class="control-item">
                            <div class="control-label">
                                <span>API Key</span>
                            </div>
                            <div class="api-instructions" id="apiInstructions" style="display: none;">
                                <p class="api-instructions-text">To use AI features: First get the passcode from Discord, then get your API key:</p>
                                <div class="api-instructions-links">
                                    <a href="https://discord.com/channels/1368975848123666553/1399823418240663592/1410359887950516224" target="_blank" class="api-instruction-link">
                                         Get Passcode from Discord
                                    </a>
                                    <a href="https://app.daydream.live/StreamDiffusionTD/api-key" target="_blank" class="api-instruction-link">
                                         Get API Key
                                    </a>
                                </div>
                            </div>
                            <input type="password" class="api-input" id="apiKeyInput" placeholder="sk_..." title="Enter your Daydream API key" />
                            <div class="checkbox-container">
                                <input type="checkbox" id="apiKeyConsent" class="checkbox-input">
                                <label for="apiKeyConsent" class="checkbox-label">Remember API key (stored locally)</label>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <button class="modern-button secondary" id="recordButton" onclick="toggleVideoRecording()">
                                Record Video
                            </button>
                        </div>
                        
                        
                        <div class="control-item">
                            <button class="modern-button secondary" onclick="window.open('https://github.com/smon1127/Diffusion-Lab/archive/refs/heads/master.zip', '_blank')">
                                Download OSC Server
                            </button>
                        </div>
                        
                        <!-- Sliders at bottom -->
                        <div class="control-item">
                            <div class="control-label">
                                <span>Inference Steps <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Denoising steps. Higher = better quality</span>
                                </div></span>
                                <span class="control-value" id="inferenceStepsValue">50</span>
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'inferenceSteps', 1, 100)">
                                <div class="slider-fill" id="inferenceStepsFill" style="width: 49%">
                                    <div class="slider-handle" id="inferenceStepsHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Seed <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Random seed. Same seed = same result</span>
                                </div></span>
                                <span class="control-value" id="seedValue">42</span>
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'seed', 0, 1000)">
                                <div class="slider-fill" id="seedFill" style="width: 4.2%">
                                    <div class="slider-handle" id="seedHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Guidance Scale <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Prompt adherence. Higher = less creativity</span>
                                </div></span>
                                <span class="control-value" id="guidanceScaleValue">7.5</span>
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'guidanceScale', 1, 20)">
                                <div class="slider-fill" id="guidanceScaleFill" style="width: 34.2%">
                                    <div class="slider-handle" id="guidanceScaleHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <div class="control-label">
                                <span>Delta <div class="tooltip"><span class="info-icon">i</span>
                                    <span class="tooltiptext">Denoising strength. Higher = more changes</span>
                                </div></span>
                                <span class="control-value" id="deltaValue">0.50</span>
                            </div>
                            <div class="slider-container" onclick="handleSliderClick(event, 'delta', 0, 1)">
                                <div class="slider-fill" id="deltaFill" style="width: 50%">
                                    <div class="slider-handle" id="deltaHandle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Keyboard shortcuts info -->
                        <div class="control-item">
                            <div class="keyboard-shortcuts-info">
                                <div class="group-title">Keyboard Shortcuts</div>
                                <div class="shortcut-item">
                                    <span>Ctrl+P:</span> Toggle Pause
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+A:</span> Toggle Animate
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+B:</span> Random Splats
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+C:</span> Toggle Colorful
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+D:</span> Toggle Debug
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+H:</span> Hide Cursor & Panel
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+O:</span> Toggle Panel
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+R:</span> Record Video
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+X:</span> Reset Values
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+V:</span> Toggle Velocity Drawing
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+Space:</span> Take Screenshot
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+1:</span> Blooming Flower
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+2:</span> Jellyfish Ballet
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+3:</span> Fractal Jellyfish
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+4:</span> Aurora Mountains
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+5:</span> Floating Islands
                                </div>
                                <div class="shortcut-item">
                                    <span>Ctrl+6:</span> Magic Forest
                                </div>
                            </div>
                            
                            <!-- Tablet shortcuts info -->
                            <div class="tablet-shortcuts-info">
                                <div class="group-title">Tablet Shortcuts</div>
                                <div class="shortcut-item">
                                    <span>2x Finger Double Tap:</span> Hide UI and Cursor
                                </div>
                            </div>
                            
                            <div class="settings-attribution">
                                Made with <span class="heart"></span> by <a href="https://www.linkedin.com/in/simonfrubis/" target="_blank">Simon Frbis</a> using <a href="https://daydream.live/" target="_blank">Daydream.live</a><br>
                                <a href="https://github.com/smon1127/Diffusion-Lab" target="_blank"><i class="fab fa-github"></i> View on GitHub</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            
            <!-- Scroll to Bottom/Top Button -->
            <button class="scroll-button" id="scrollButton" onclick="toggleScroll()" ontouchstart="toggleScroll(); event.preventDefault();">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>

        <script src="coloris.min.js"></script>
        <script src="./script.js"></script>
        
        <script>
        // Mobile touch handling - prevent double-tap issues
        document.addEventListener('DOMContentLoaded', function() {
            // Remove redundant touch events that cause double-firing
            const elements = document.querySelectorAll('[ontouchstart]');
            elements.forEach(element => {
                const touchHandler = element.getAttribute('ontouchstart');
                const clickHandler = element.getAttribute('onclick');
                
                if (touchHandler && clickHandler) {
                    // Remove the ontouchstart attribute to prevent double-firing
                    element.removeAttribute('ontouchstart');
                    
                    // Add proper touch event listener that prevents default and stops propagation
                    element.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Execute the click handler function
                        try {
                            if (clickHandler.includes('(')) {
                                // If it's a function call, evaluate it
                                eval(clickHandler);
                            } else {
                                // If it's just a function name, call it
                                window[clickHandler](e);
                            }
                        } catch (error) {
                            console.error('Touch handler error:', error);
                        }
                    }, { passive: false });
                }
            });
        });

        // Dynamic tooltip positioning
        document.addEventListener('DOMContentLoaded', function() {
            function positionTooltip(button, tooltip) {
                const rect = button.getBoundingClientRect();
                
                // Make tooltip visible temporarily to measure it
                tooltip.style.display = 'block';
                tooltip.style.visibility = 'visible';
                tooltip.style.opacity = '0';
                const tooltipRect = tooltip.getBoundingClientRect();
                tooltip.style.display = 'none';
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '';
                
                // Calculate center position
                const centerX = rect.left + (rect.width / 2);
                const topY = rect.top - tooltipRect.height - 12;
                
                // Position tooltip centered above button
                tooltip.style.left = (centerX - (tooltipRect.width / 2)) + 'px';
                tooltip.style.top = Math.max(10, topY) + 'px'; // Prevent tooltip from going off-screen
            }
            
            const buttons = document.querySelectorAll('.stream-control-button');
            
            buttons.forEach(button => {
                const tooltip = button.querySelector('.tooltiptext');
                if (!tooltip) return;
                
                button.addEventListener('mouseenter', function() {
                    positionTooltip(button, tooltip);
                });
                
                // Also reposition on window resize
                window.addEventListener('resize', function() {
                    if (tooltip.style.visibility === 'visible') {
                        positionTooltip(button, tooltip);
                    }
                });
            });
        });
        </script>
        <script>
            // Mobile-friendly tooltip system
            document.addEventListener('DOMContentLoaded', function() {
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile) {
                    const tooltips = document.querySelectorAll('.tooltip');
                    let activeTooltip = null;
                    
                    tooltips.forEach(tooltip => {
                        const infoIcon = tooltip.querySelector('.info-icon');
                        const tooltipText = tooltip.querySelector('.tooltiptext');
                        
                        if (infoIcon && tooltipText) {
                            // Add touch event for showing tooltip
                            infoIcon.addEventListener('touchstart', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                // Close any active tooltip
                                if (activeTooltip && activeTooltip !== tooltip) {
                                    activeTooltip.classList.remove('mobile-active');
                                }
                                
                                // Toggle current tooltip
                                if (tooltip.classList.contains('mobile-active')) {
                                    tooltip.classList.remove('mobile-active');
                                    activeTooltip = null;
                                } else {
                                    tooltip.classList.add('mobile-active');
                                    activeTooltip = tooltip;
                                    
                                    // Adjust position if tooltip would go off-screen
                                    adjustTooltipPosition(tooltipText);
                                }
                            });
                            
                            // Prevent default click behavior
                            infoIcon.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                            });
                        }
                    });
                    
                    // Close tooltip when tapping outside
                    document.addEventListener('touchstart', function(e) {
                        if (activeTooltip && !e.target.closest('.tooltip')) {
                            activeTooltip.classList.remove('mobile-active');
                            activeTooltip = null;
                        }
                    });
                    
                    // Function to adjust tooltip position
                    function adjustTooltipPosition(tooltipText) {
                        const rect = tooltipText.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        
                        // Reset classes
                        tooltipText.classList.remove('adjust-left', 'adjust-right');
                        
                        // Check if tooltip goes off left edge
                        if (rect.left < 20) {
                            tooltipText.classList.add('adjust-left');
                        }
                        // Check if tooltip goes off right edge
                        else if (rect.right > viewportWidth - 20) {
                            tooltipText.classList.add('adjust-right');
                        }
                    }
                    
                    // Handle orientation change
                    window.addEventListener('orientationchange', function() {
                        setTimeout(() => {
                            if (activeTooltip) {
                                const tooltipText = activeTooltip.querySelector('.tooltiptext');
                                if (tooltipText) {
                                    adjustTooltipPosition(tooltipText);
                                }
                            }
                        }, 100);
                    });
                }
                
                // Enhanced mobile interaction for preset buttons and toggles
                if (isMobile) {
                    // Add touch feedback for preset buttons without interfering with click events
                    const presetButtons = document.querySelectorAll('.preset-btn, .preset-button');
                    presetButtons.forEach(button => {
                        button.addEventListener('touchstart', function(e) {
                            // Don't prevent default to allow click events to work
                            this.style.transform = 'scale(0.95)';
                        }, { passive: true });
                        
                        button.addEventListener('touchend', function(e) {
                            // Don't prevent default to allow click events to work
                            setTimeout(() => {
                                this.style.transform = '';
                            }, 150);
                        }, { passive: true });
                        
                        button.addEventListener('touchcancel', function(e) {
                            this.style.transform = '';
                        }, { passive: true });
                    });
                    
                    // Improve advanced toggle interaction
                    const advancedToggles = document.querySelectorAll('.advanced-toggle');
                    advancedToggles.forEach(toggle => {
                        toggle.addEventListener('touchstart', function(e) {
                            this.style.background = 'rgba(6, 163, 215, 0.1)';
                        });
                        
                        toggle.addEventListener('touchend', function(e) {
                            setTimeout(() => {
                                this.style.background = '';
                            }, 200);
                        });
                        
                        toggle.addEventListener('touchcancel', function(e) {
                            this.style.background = '';
                        });
                    });
                }
                
                // Auto-resize textarea functionality
                function setupAutoResizeTextarea() {
                    const textarea = document.getElementById('promptInput');
                    if (textarea) {
                        // Function to adjust textarea height
                        function adjustHeight() {
                            textarea.style.height = 'auto';
                            const scrollHeight = textarea.scrollHeight;
                            const minHeight = isMobile ? 44 : 40;
                            const maxHeight = isMobile ? 140 : 120;
                            
                            if (scrollHeight > maxHeight) {
                                textarea.style.height = maxHeight + 'px';
                                textarea.style.overflowY = 'auto';
                            } else if (scrollHeight < minHeight) {
                                textarea.style.height = minHeight + 'px';
                                textarea.style.overflowY = 'hidden';
                            } else {
                                textarea.style.height = scrollHeight + 'px';
                                textarea.style.overflowY = 'hidden';
                            }
                        }
                        
                        // Initial adjustment
                        adjustHeight();
                        
                        // Adjust on input
                        textarea.addEventListener('input', adjustHeight);
                        
                        // Adjust on focus (in case content was set programmatically)
                        textarea.addEventListener('focus', () => {
                            setTimeout(adjustHeight, 0);
                        });
                        
                        // Adjust when preset prompts are loaded
                        const originalSetPrompt = window.setPrompt;
                        if (originalSetPrompt) {
                            window.setPrompt = function(promptText) {
                                originalSetPrompt(promptText);
                                setTimeout(adjustHeight, 0);
                            };
                        }
                    }
                }
                
                // Initialize auto-resize functionality
                setupAutoResizeTextarea();
                
                // Initialize scroll button functionality
                setupScrollButton();
            });
            
            // Scroll button functionality
            function setupScrollButton() {
                const scrollButton = document.getElementById('scrollButton');
                const panelContent = document.getElementById('panelContent');
                
                if (!scrollButton || !panelContent) return;
                
                // Function to update button state based on scroll position
                function updateScrollButton() {
                    const scrollTop = panelContent.scrollTop;
                    const scrollHeight = panelContent.scrollHeight;
                    const clientHeight = panelContent.clientHeight;
                    const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5; // 5px tolerance
                    
                    if (isAtBottom) {
                        scrollButton.innerHTML = '<i class="fas fa-chevron-up"></i>';
                        scrollButton.title = 'Scroll to top';
                    } else {
                        scrollButton.innerHTML = '<i class="fas fa-chevron-down"></i>';
                        scrollButton.title = 'Scroll to bottom';
                    }
                }
                
                // Function to toggle scroll position
                window.toggleScroll = function() {
                    const scrollTop = panelContent.scrollTop;
                    const scrollHeight = panelContent.scrollHeight;
                    const clientHeight = panelContent.clientHeight;
                    const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5;
                    
                    if (isAtBottom) {
                        // Scroll to top
                        panelContent.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    } else {
                        // Scroll to bottom
                        panelContent.scrollTo({
                            top: scrollHeight,
                            behavior: 'smooth'
                        });
                    }
                };
                
                // Listen for scroll events
                panelContent.addEventListener('scroll', updateScrollButton);
                
                // Initial state
                updateScrollButton();
            }
        </script>
        
        <!-- QRious - Simple and reliable QR code library -->
        <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js" 
                onload="console.log(' QRious library loaded successfully')" 
                onerror="console.error(' Failed to load QRious library')"></script>

    </body>
</html>